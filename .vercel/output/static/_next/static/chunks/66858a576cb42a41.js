(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11022,e=>{e.v({active:"ConversationSidebar-module__6Hodma__active",archivedItem:"ConversationSidebar-module__6Hodma__archivedItem",archivedSection:"ConversationSidebar-module__6Hodma__archivedSection",avatar:"ConversationSidebar-module__6Hodma__avatar",avatarSam:"ConversationSidebar-module__6Hodma__avatarSam",badge:"ConversationSidebar-module__6Hodma__badge",badges:"ConversationSidebar-module__6Hodma__badges",content:"ConversationSidebar-module__6Hodma__content",emptyState:"ConversationSidebar-module__6Hodma__emptyState",header:"ConversationSidebar-module__6Hodma__header",headerTitle:"ConversationSidebar-module__6Hodma__headerTitle",list:"ConversationSidebar-module__6Hodma__list",listItem:"ConversationSidebar-module__6Hodma__listItem",name:"ConversationSidebar-module__6Hodma__name",preview:"ConversationSidebar-module__6Hodma__preview",pullIndicator:"ConversationSidebar-module__6Hodma__pullIndicator",samItem:"ConversationSidebar-module__6Hodma__samItem",scroller:"ConversationSidebar-module__6Hodma__scroller",sectionTitle:"ConversationSidebar-module__6Hodma__sectionTitle",sidebar:"ConversationSidebar-module__6Hodma__sidebar",sidebarCollapsed:"ConversationSidebar-module__6Hodma__sidebarCollapsed",status:"ConversationSidebar-module__6Hodma__status",statusActive:"ConversationSidebar-module__6Hodma__statusActive",statusScheduled:"ConversationSidebar-module__6Hodma__statusScheduled",timestamp:"ConversationSidebar-module__6Hodma__timestamp",topRow:"ConversationSidebar-module__6Hodma__topRow",unarchiveButton:"ConversationSidebar-module__6Hodma__unarchiveButton",unread:"ConversationSidebar-module__6Hodma__unread"})},98891,e=>{e.v({actionButton:"ConversationView-module__4lpiyq__actionButton",actionButtons:"ConversationView-module__4lpiyq__actionButtons",actionStack:"ConversationView-module__4lpiyq__actionStack",actions:"ConversationView-module__4lpiyq__actions",archivedNotice:"ConversationView-module__4lpiyq__archivedNotice",archivedView:"ConversationView-module__4lpiyq__archivedView",audioMeter:"ConversationView-module__4lpiyq__audioMeter",audioMeterLevel:"ConversationView-module__4lpiyq__audioMeterLevel",backButton:"ConversationView-module__4lpiyq__backButton",billingBadge:"ConversationView-module__4lpiyq__billingBadge",billingSubtext:"ConversationView-module__4lpiyq__billingSubtext",bubble:"ConversationView-module__4lpiyq__bubble",bubbleRow:"ConversationView-module__4lpiyq__bubbleRow",calendarGrid:"ConversationView-module__4lpiyq__calendarGrid",chatArea:"ConversationView-module__4lpiyq__chatArea",chatInputBar:"ConversationView-module__4lpiyq__chatInputBar",chatPanel:"ConversationView-module__4lpiyq__chatPanel",chatSection:"ConversationView-module__4lpiyq__chatSection",confirmationCard:"ConversationView-module__4lpiyq__confirmationCard",container:"ConversationView-module__4lpiyq__container",controlButton:"ConversationView-module__4lpiyq__controlButton",controlButtonDanger:"ConversationView-module__4lpiyq__controlButtonDanger",controlButtonMuted:"ConversationView-module__4lpiyq__controlButtonMuted",controlsOverlay:"ConversationView-module__4lpiyq__controlsOverlay",controlsRow:"ConversationView-module__4lpiyq__controlsRow",countdown:"ConversationView-module__4lpiyq__countdown",donationAmountButton:"ConversationView-module__4lpiyq__donationAmountButton",donationAmountButtonActive:"ConversationView-module__4lpiyq__donationAmountButtonActive",donationCard:"ConversationView-module__4lpiyq__donationCard",donationFooter:"ConversationView-module__4lpiyq__donationFooter",donationGrid:"ConversationView-module__4lpiyq__donationGrid",donationInputRow:"ConversationView-module__4lpiyq__donationInputRow",donationModal:"ConversationView-module__4lpiyq__donationModal",endCallActions:"ConversationView-module__4lpiyq__endCallActions",endCallCard:"ConversationView-module__4lpiyq__endCallCard",endCallOverlay:"ConversationView-module__4lpiyq__endCallOverlay",error:"ConversationView-module__4lpiyq__error",errorState:"ConversationView-module__4lpiyq__errorState",header:"ConversationView-module__4lpiyq__header",headerTitleStack:"ConversationView-module__4lpiyq__headerTitleStack",humanView:"ConversationView-module__4lpiyq__humanView",inputBar:"ConversationView-module__4lpiyq__inputBar",inputStatus:"ConversationView-module__4lpiyq__inputStatus",loading:"ConversationView-module__4lpiyq__loading",localPreview:"ConversationView-module__4lpiyq__localPreview",messageBubble:"ConversationView-module__4lpiyq__messageBubble",messageList:"ConversationView-module__4lpiyq__messageList",messageMeta:"ConversationView-module__4lpiyq__messageMeta",mobileContainer:"ConversationView-module__4lpiyq__mobileContainer",noticeBanner:"ConversationView-module__4lpiyq__noticeBanner",placeholder:"ConversationView-module__4lpiyq__placeholder",primaryButton:"ConversationView-module__4lpiyq__primaryButton",profileCard:"ConversationView-module__4lpiyq__profileCard",profileHeadline:"ConversationView-module__4lpiyq__profileHeadline",profileScroller:"ConversationView-module__4lpiyq__profileScroller",pulse:"ConversationView-module__4lpiyq__pulse",remoteVideo:"ConversationView-module__4lpiyq__remoteVideo",samRow:"ConversationView-module__4lpiyq__samRow",samView:"ConversationView-module__4lpiyq__samView",secondaryButton:"ConversationView-module__4lpiyq__secondaryButton",sessionLayout:"ConversationView-module__4lpiyq__sessionLayout",sessionShell:"ConversationView-module__4lpiyq__sessionShell",slotButton:"ConversationView-module__4lpiyq__slotButton",statusBadge:"ConversationView-module__4lpiyq__statusBadge",statusBadgeSuccess:"ConversationView-module__4lpiyq__statusBadgeSuccess",subtitle:"ConversationView-module__4lpiyq__subtitle",timerBadge:"ConversationView-module__4lpiyq__timerBadge",title:"ConversationView-module__4lpiyq__title",typingDot:"ConversationView-module__4lpiyq__typingDot",typingIndicator:"ConversationView-module__4lpiyq__typingIndicator",userRow:"ConversationView-module__4lpiyq__userRow",videoAreaWrapper:"ConversationView-module__4lpiyq__videoAreaWrapper",videoOverlay:"ConversationView-module__4lpiyq__videoOverlay",videoPanel:"ConversationView-module__4lpiyq__videoPanel",videoSection:"ConversationView-module__4lpiyq__videoSection",videoStage:"ConversationView-module__4lpiyq__videoStage",videoStatsRow:"ConversationView-module__4lpiyq__videoStatsRow",viewArea:"ConversationView-module__4lpiyq__viewArea"})},25960,e=>{e.v({actions:"ProfileCard-module__HFoQ4a__actions",avatar:"ProfileCard-module__HFoQ4a__avatar",badge:"ProfileCard-module__HFoQ4a__badge",badgeGroup:"ProfileCard-module__HFoQ4a__badgeGroup",bio:"ProfileCard-module__HFoQ4a__bio",bioCollapsed:"ProfileCard-module__HFoQ4a__bioCollapsed",card:"ProfileCard-module__HFoQ4a__card",charityBadge:"ProfileCard-module__HFoQ4a__charityBadge",charityBadgeCompact:"ProfileCard-module__HFoQ4a__charityBadgeCompact",charityRate:"ProfileCard-module__HFoQ4a__charityRate",charitySubtext:"ProfileCard-module__HFoQ4a__charitySubtext",confidentialBadge:"ProfileCard-module__HFoQ4a__confidentialBadge",freeBadge:"ProfileCard-module__HFoQ4a__freeBadge",headerRow:"ProfileCard-module__HFoQ4a__headerRow",headline:"ProfileCard-module__HFoQ4a__headline",name:"ProfileCard-module__HFoQ4a__name",nameBlock:"ProfileCard-module__HFoQ4a__nameBlock",paidBadge:"ProfileCard-module__HFoQ4a__paidBadge",primaryButton:"ProfileCard-module__HFoQ4a__primaryButton",rateBadges:"ProfileCard-module__HFoQ4a__rateBadges",rateSection:"ProfileCard-module__HFoQ4a__rateSection",readMore:"ProfileCard-module__HFoQ4a__readMore",requestButton:"ProfileCard-module__HFoQ4a__requestButton",scheduledPill:"ProfileCard-module__HFoQ4a__scheduledPill",scheduledPills:"ProfileCard-module__HFoQ4a__scheduledPills",secondaryButton:"ProfileCard-module__HFoQ4a__secondaryButton",sessionBlurb:"ProfileCard-module__HFoQ4a__sessionBlurb",statusBadge:"ProfileCard-module__HFoQ4a__statusBadge",statusIdle:"ProfileCard-module__HFoQ4a__statusIdle",statusInCall:"ProfileCard-module__HFoQ4a__statusInCall",statusOffline:"ProfileCard-module__HFoQ4a__statusOffline",statusOnline:"ProfileCard-module__HFoQ4a__statusOnline",tipBadge:"ProfileCard-module__HFoQ4a__tipBadge",tooltip:"ProfileCard-module__HFoQ4a__tooltip",tooltipText:"ProfileCard-module__HFoQ4a__tooltipText"})},77841,e=>{e.v({avatar:"BookingModal-module__ned4kG__avatar",buttonRow:"BookingModal-module__ned4kG__buttonRow",closeButton:"BookingModal-module__ned4kG__closeButton",confirmationCard:"BookingModal-module__ned4kG__confirmationCard",durationButton:"BookingModal-module__ned4kG__durationButton",durationButtonActive:"BookingModal-module__ned4kG__durationButtonActive",durationRow:"BookingModal-module__ned4kG__durationRow",emptyState:"BookingModal-module__ned4kG__emptyState",errorState:"BookingModal-module__ned4kG__errorState",header:"BookingModal-module__ned4kG__header",loadingState:"BookingModal-module__ned4kG__loadingState",modal:"BookingModal-module__ned4kG__modal",modalInner:"BookingModal-module__ned4kG__modalInner",overlay:"BookingModal-module__ned4kG__overlay",priceRow:"BookingModal-module__ned4kG__priceRow",primaryButton:"BookingModal-module__ned4kG__primaryButton",secondaryButton:"BookingModal-module__ned4kG__secondaryButton",selectButton:"BookingModal-module__ned4kG__selectButton",slotCard:"BookingModal-module__ned4kG__slotCard",slotDate:"BookingModal-module__ned4kG__slotDate",slotGrid:"BookingModal-module__ned4kG__slotGrid",slotTime:"BookingModal-module__ned4kG__slotTime",subtitle:"BookingModal-module__ned4kG__subtitle",successMessage:"BookingModal-module__ned4kG__successMessage",successState:"BookingModal-module__ned4kG__successState",summaryLabel:"BookingModal-module__ned4kG__summaryLabel",summaryRow:"BookingModal-module__ned4kG__summaryRow",summaryValue:"BookingModal-module__ned4kG__summaryValue",title:"BookingModal-module__ned4kG__title",titleStack:"BookingModal-module__ned4kG__titleStack"})},46246,e=>{e.v({avatar:"RequestForm-module__iqRmLa__avatar",closeButton:"RequestForm-module__iqRmLa__closeButton",error:"RequestForm-module__iqRmLa__error",form:"RequestForm-module__iqRmLa__form",header:"RequestForm-module__iqRmLa__header",headerLeft:"RequestForm-module__iqRmLa__headerLeft",label:"RequestForm-module__iqRmLa__label",modal:"RequestForm-module__iqRmLa__modal",optional:"RequestForm-module__iqRmLa__optional",overlay:"RequestForm-module__iqRmLa__overlay",primaryButton:"RequestForm-module__iqRmLa__primaryButton",submitButton:"RequestForm-module__iqRmLa__submitButton",subtitle:"RequestForm-module__iqRmLa__subtitle",successIcon:"RequestForm-module__iqRmLa__successIcon",successState:"RequestForm-module__iqRmLa__successState",title:"RequestForm-module__iqRmLa__title"})},19596,e=>{"use strict";var t=e.i(43476),a=e.i(71645),n=e.i(7670),s=e.i(11022);let i={active:"â—",scheduled:"â°"},o={active:s.default.statusActive,scheduled:s.default.statusScheduled};function r({entry:e,isActive:r,onSelect:l,onArchive:d,showMetadata:c=!0,disableGestures:u}){let{conversation:m,meta:h}=e,f="sam"===m.type,p=m.unreadCount??0,_=(0,a.useRef)(null),v=(0,a.useRef)(0),g=()=>l(m.conversationId),y=h?.status,x=y?o[y]:void 0,b=encodeURIComponent(h?.displayName??m.conversationId),w=f?"/icon.svg":`https://api.dicebear.com/8.x/initials/svg?seed=${b}`;return(0,t.jsxs)("li",{className:(0,n.default)(s.default.listItem,r&&s.default.active,f&&s.default.samItem),role:"button",tabIndex:0,onClick:g,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),g())},onTouchStart:e=>{u||(_.current=e.touches[0].clientX)},onTouchMove:e=>{u||null===_.current||(v.current=e.touches[0].clientX-_.current)},onTouchEnd:()=>{u||null===_.current||(v.current<-60&&d&&d(m.conversationId),_.current=null,v.current=0)},children:[(0,t.jsx)("div",{className:(0,n.default)(s.default.avatar,f&&s.default.avatarSam),children:(0,t.jsx)("img",{src:w,alt:h?.displayName??"Conversation",loading:"lazy",decoding:"async"})}),c&&(0,t.jsxs)("div",{className:s.default.content,children:[(0,t.jsxs)("div",{className:s.default.topRow,children:[(0,t.jsx)("span",{className:s.default.name,children:h?.displayName??"Unknown"}),(0,t.jsx)("span",{className:s.default.timestamp,children:h?.relativeTimestamp})]}),(0,t.jsx)("div",{className:s.default.preview,children:h?.lastMessage??"No messages yet"}),(0,t.jsxs)("div",{className:s.default.badges,children:[y&&x&&(0,t.jsxs)("span",{className:(0,n.default)(s.default.status,x),children:[i[y]," ","active"===y?"Active":"Scheduled"]}),p>0&&(0,t.jsx)("span",{className:(0,n.default)(s.default.badge,s.default.unread),children:Math.min(p,99)})]})]})]})}var l=e.i(48665);let d="humanchat.archivedConversations";function c({activeConversationId:e,onSelectConversation:i,collapsed:o}){let{conversations:c,hasHumanConversations:u,error:m,reload:h,refreshing:f}=(0,l.useConversationData)(),{archive:p,unarchive:_,archivedIds:v,isArchived:g}=(()=>{let[e,t]=(0,a.useState)({});(0,a.useEffect)(()=>{try{let e=window.localStorage.getItem(d);e&&t(JSON.parse(e))}catch(e){console.warn("Failed to read archived conversations",e)}},[]),(0,a.useEffect)(()=>{try{window.localStorage.setItem(d,JSON.stringify(e))}catch(e){console.warn("Failed to persist archived conversations",e)}},[e]);let n=(0,a.useCallback)(e=>{t(t=>({...t,[e]:Date.now()}))},[]),s=(0,a.useCallback)(e=>{t(t=>{let a={...t};return delete a[e],a})},[]),i=(0,a.useCallback)(t=>!!e[t],[e]);return{archive:n,unarchive:s,archivedIds:Object.keys(e).sort((t,a)=>(e[a]??0)-(e[t]??0)),isArchived:i}})(),[y,x]=(0,a.useState)("idle"),b=(0,a.useRef)(null),w=(0,a.useRef)(0),S=(0,a.useRef)(!1),C=e=>{i?.(e)},j=c[0],N=c.slice(1).filter(e=>!g(e.conversation.conversationId)),I=c.slice(1).filter(e=>g(e.conversation.conversationId)),k=async()=>{"ready"===y&&(x("refreshing"),await h()),x("idle"),S.current=!1};return(0,t.jsxs)("aside",{className:(0,n.default)(s.default.sidebar,o&&s.default.sidebarCollapsed),children:[(0,t.jsxs)("div",{className:s.default.header,children:[(0,t.jsx)("span",{className:s.default.headerTitle,children:"Conversations"}),(0,t.jsx)("span",{className:s.default.timestamp,children:new Date().toLocaleDateString()})]}),(0,t.jsxs)("div",{className:s.default.scroller,ref:b,onTouchStart:e=>{!b.current||b.current.scrollTop>0||(S.current=!0,w.current=e.touches[0].clientY)},onTouchMove:e=>{if(!S.current)return;let t=e.touches[0].clientY-w.current;if(t<0){S.current=!1,x("idle");return}t>80?x("ready"):x("idle")},onTouchEnd:k,children:[("ready"===y||"refreshing"===y||f)&&(0,t.jsx)("div",{className:s.default.pullIndicator,children:"refreshing"===y||f?"Refreshingâ€¦":"Release to refresh"}),(0,t.jsx)("p",{className:s.default.sectionTitle,children:"Concierge"}),(0,t.jsx)("ul",{className:s.default.list,children:j&&(0,t.jsx)(r,{entry:j,isActive:e===j.conversation.conversationId,onSelect:C,onArchive:p,showMetadata:!o})}),(0,t.jsx)("p",{className:s.default.sectionTitle,children:"Humans"}),(0,t.jsx)("ul",{className:s.default.list,children:N.map(a=>(0,t.jsx)(r,{entry:a,isActive:e===a.conversation.conversationId,onSelect:C,onArchive:p,showMetadata:!o},a.conversation.conversationId))}),!u&&(0,t.jsxs)("div",{className:s.default.emptyState,children:[(0,t.jsx)("strong",{children:"No human conversations yet."}),(0,t.jsx)("p",{style:{marginTop:"8px",marginBottom:0},children:"Once you connect with guests, they will appear here with their latest activity."})]}),m&&(0,t.jsx)("div",{className:(0,n.default)(s.default.emptyState),style:{borderColor:"#f87171",color:"#fecaca"},children:"Failed to load conversations. Please refresh."}),I.length>0&&(0,t.jsxs)("div",{className:s.default.archivedSection,children:[(0,t.jsx)("p",{className:s.default.sectionTitle,children:"Archived"}),(0,t.jsx)("ul",{className:s.default.list,children:I.map(e=>(0,t.jsxs)("li",{className:s.default.archivedItem,children:[(0,t.jsx)(r,{entry:e,isActive:!1,onSelect:C,showMetadata:!o,disableGestures:!0}),(0,t.jsx)("button",{type:"button",className:s.default.unarchiveButton,onClick:()=>_(e.conversation.conversationId),children:"Unarchive"})]},e.conversation.conversationId))})]})]})]})}var u=e.i(98891),m=e.i(20437),h=e.i(69152);let f={conversation:null,session:null,messages:[],loading:!1,error:null},p=async()=>{let e=await h.db.conversations.get(l.SAM_CONCIERGE_ID);if(e)return e;let t={...l.SAM_FALLBACK_CONVERSATION,lastActivity:Date.now()};return await h.db.conversations.put(t),t},_=async e=>{let t=await h.db.conversations.get(e);if(!t){if(e===l.SAM_CONCIERGE_ID){let e=await p(),t=await h.db.messages.where("conversationId").equals(e.conversationId).sortBy("timestamp");return{conversation:e,session:null,messages:t}}return null}let[a,n]=await Promise.all([h.db.messages.where("conversationId").equals(e).sortBy("timestamp"),t.linkedSessionId?h.db.sessions.get(t.linkedSessionId):null]);return{conversation:t,session:n,messages:a}};var v=e.i(47167);let g=async({conversationId:e,message:t,conversationHistory:a,userContext:n})=>{let s=await fetch(`https://api.humanchat.com/api/sam/chat?conversationId=${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:t,conversationHistory:a,userContext:n})});if(!s.ok)throw Error(await s.text().catch(()=>"")||"Failed to reach Sam concierge");var i=await s.json();if(i&&"object"==typeof i&&"success"in i){if(i.success)return i.data;throw Error(i.error?.message??"Sam concierge request failed")}if(i?.text||i?.actions||i?.conversationId)return i;if(i?.message)return{text:i.message,actions:i.actions,conversationId:i.conversationId};throw Error("Unexpected response from Sam concierge")};function y({message:e,variant:s,children:i,onQuickReply:o}){let r=(0,a.useRef)(null),l=(0,a.useRef)(0);return(0,t.jsx)("div",{className:(0,n.default)(u.default.bubbleRow,"sam"===s?u.default.samRow:u.default.userRow),onTouchStart:e=>{r.current=e.touches[0].clientX},onTouchMove:e=>{null!==r.current&&(l.current=e.touches[0].clientX-r.current)},onTouchEnd:()=>{null!==r.current&&(l.current>60&&o&&o(e),r.current=null,l.current=0)},children:(0,t.jsxs)("div",{className:u.default.messageBubble,children:[(0,t.jsx)("div",{className:u.default.bubble,children:e.content}),i,(0,t.jsx)("span",{className:u.default.messageMeta,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}var x=e.i(25960);let b={online:{label:"Online",color:x.default.statusOnline,icon:"ðŸŸ¢"},inCall:{label:"Online â€¢ In Call",color:x.default.statusInCall,icon:"ðŸŸ¡"},idle:{label:"Idle",color:x.default.statusIdle,icon:"ðŸŸ "},offline:{label:"Offline",color:x.default.statusOffline,icon:"âšª"}};function w({isOnline:e,hasActiveSession:a,presenceState:s}){let i="offline";a?i="inCall":"idle"===s?i="idle":e&&(i="online");let o=b[i];return(0,t.jsxs)("span",{className:(0,n.default)(x.default.statusBadge,o.color),children:[(0,t.jsx)("span",{"aria-hidden":!0,children:o.icon})," ",o.label]})}function S({charityName:e,className:a,compact:s=!1}){return e?(0,t.jsxs)("span",{className:(0,n.default)(x.default.badge,x.default.charityBadge,s&&x.default.charityBadgeCompact,a),children:["ðŸ’š Proceeds benefit ",e]}):(0,t.jsx)("span",{className:(0,n.default)(x.default.badge,x.default.charityBadge,a),children:"ðŸ’š Proceeds benefit our charity partners"})}let C=e=>null==e?"":`$${e.toFixed(2)}`;function j({conversationType:e,confidentialRate:a,displayMode:s,instantRatePerMinute:i,scheduledRates:o,isOnline:r,charityName:l,donationPreference:d}){let c=!!(a||"confidential"===s||"by_request"===s);return(0,t.jsxs)("div",{className:x.default.rateSection,children:[(0,t.jsxs)("div",{className:x.default.badgeGroup,children:["free"===e&&(0,t.jsx)("span",{className:(0,n.default)(x.default.badge,x.default.freeBadge),children:"Free"}),"charity"===e&&(0,t.jsx)(S,{charityName:l}),c&&(0,t.jsx)("span",{className:(0,n.default)(x.default.badge,x.default.confidentialBadge),children:"Available by Request"}),"paid"===e&&!c&&r&&null!=i&&(0,t.jsxs)("span",{className:(0,n.default)(x.default.badge,x.default.paidBadge),children:[C(i),"/min"]}),"on"===d&&(0,t.jsx)("span",{className:(0,n.default)(x.default.badge,x.default.tipBadge),children:"Accepts tips â­"})]}),"charity"===e&&(0,t.jsxs)("div",{children:[null!=i&&(0,t.jsx)("div",{className:x.default.charityRate,children:(0,t.jsxs)("span",{children:[C(i),"/min â†’ ",l??"our charity partner"]})}),(0,t.jsx)("p",{className:x.default.charitySubtext,children:"100% goes to charity"})]}),o&&o.length>0&&(0,t.jsx)("div",{className:x.default.scheduledPills,children:o.map(e=>(0,t.jsxs)("span",{className:x.default.scheduledPill,children:[e.durationMinutes," min â€¢ ",C(e.price)]},`${e.durationMinutes}-${e.price}`))})]})}let N=e=>{let t=e?.trim();return t&&t.length>0?t:"Human"};function I({profile:e,onConnectNow:s,onBookTime:i,isConnecting:o}){var r;let l,[d,c]=(0,a.useState)(!1),u=!!(e.isOnline&&!e.hasActiveSession),m=e.hasActiveSession?"Currently in a call":void 0,h=!!(e.managed&&e.confidentialRate),f=N(e.headline),p=N(e.bio),_=(r=e.bio,!!((l=r?.trim())&&l.length>0)),v=(0,a.useMemo)(()=>h?`${e.name??"This talent"} works through a representative. Send a request and their team will coordinate the details.`:"charity"===e.conversationType&&e.instantRatePerMinute?`${e.name} charges $${e.instantRatePerMinute.toFixed(2)}/min â€” all proceeds go to ${e.charityName??"their charity partner"}.`:"free"===e.conversationType&&"on"===e.donationPreference?`${e.name} talks for free and accepts tips.`:"paid"===e.conversationType&&"on"===e.donationPreference?`${e.name} offers paid sessions with optional donations.`:null,[h,e.conversationType,e.donationPreference,e.instantRatePerMinute,e.name,e.charityName]),g=h?"Send Request":"Book Time",y=h?x.default.requestButton:x.default.secondaryButton;return(0,t.jsxs)("article",{className:x.default.card,children:[(0,t.jsxs)("div",{className:x.default.headerRow,children:[(0,t.jsx)("img",{src:e.avatarUrl||`https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(e.name??"Human")}`,alt:e.name,className:x.default.avatar,loading:"lazy"}),(0,t.jsxs)("div",{className:x.default.nameBlock,children:[(0,t.jsx)("strong",{className:x.default.name,children:e.name}),(0,t.jsx)("p",{className:x.default.headline,children:f})]})]}),(0,t.jsx)(w,{isOnline:e.isOnline,hasActiveSession:e.hasActiveSession,presenceState:e.presenceState}),p&&(0,t.jsxs)("div",{className:(0,n.default)(x.default.bio,!d&&x.default.bioCollapsed),children:[p,!d&&_&&(0,t.jsx)("button",{className:x.default.readMore,type:"button",onClick:()=>c(!0),children:"Read more"})]}),(0,t.jsx)(j,{conversationType:e.conversationType,confidentialRate:e.confidentialRate,displayMode:e.displayMode,instantRatePerMinute:e.instantRatePerMinute,scheduledRates:e.scheduledRates,isOnline:e.isOnline,charityName:e.charityName,donationPreference:e.donationPreference}),v&&(0,t.jsx)("p",{className:x.default.sessionBlurb,children:v}),(0,t.jsxs)("div",{className:x.default.actions,children:[!h&&(0,t.jsxs)("div",{className:x.default.tooltip,children:[(0,t.jsx)("button",{className:x.default.primaryButton,type:"button",disabled:!u||!!o,onClick:()=>u&&!o&&s?.(e),children:o?"Connectingâ€¦":"Connect Now"}),m&&(0,t.jsx)("span",{className:x.default.tooltipText,children:m})]}),(0,t.jsx)("button",{className:y,type:"button",onClick:()=>i?.(e),children:g})]})]})}let k=e=>e?`$${e.toFixed(2)}/min`:"",M=e=>void 0!==e.userId,B=({profile:e})=>{let a="away"===e.status?"idle":"active";return(0,t.jsxs)("div",{className:u.default.profileCard,children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:e.name}),e.headline&&(0,t.jsx)("p",{className:u.default.profileHeadline,children:e.headline})]}),"number"==typeof e.rate_per_minute&&e.rate_per_minute>0&&(0,t.jsx)("span",{className:u.default.profileHeadline,children:k(e.rate_per_minute)})]}),e.expertise&&e.expertise.length>0&&(0,t.jsxs)("p",{className:u.default.profileHeadline,children:["Focus: ",e.expertise.join(" â€¢ ")]}),(0,t.jsx)(w,{isOnline:"available"===e.status,hasActiveSession:"booked"===e.status,presenceState:a})]})},R=({action:e,onOpenConversation:a})=>(0,t.jsxs)("div",{className:u.default.actionStack,children:[(0,t.jsx)("strong",{children:"Connection options"}),e.connectionOptions?.map((n,s)=>(0,t.jsxs)("div",{className:u.default.profileCard,children:[(0,t.jsx)("div",{children:n.mode.toUpperCase()}),(0,t.jsx)("p",{className:u.default.profileHeadline,children:k(n.ratePerMinute)}),(0,t.jsx)("button",{className:u.default.primaryButton,type:"button",onClick:()=>a?.(e.targetUserId),children:"Connect"})]},n.mode+s))]});function T({action:e,onOpenConversation:a,onCreateSession:n,onSelectSlot:s,onConnectNow:i,onBookTime:o,connectingProfileId:r}){if(!e)return null;switch(e.type||e.actionType){case"show_profiles":{let a=e.profiles??[],n=a.filter(M),s=a.filter(e=>!M(e));if(n.length>0)return(0,t.jsx)("div",{className:u.default.profileScroller,children:n.map(e=>(0,t.jsx)(I,{profile:e,onConnectNow:i,onBookTime:o,isConnecting:r===e.userId},e.userId))});return(0,t.jsx)("div",{className:u.default.profileScroller,children:s.map((e,a)=>(0,t.jsx)(B,{profile:e},`${e.name}-${a}`))})}case"offer_connection":return(0,t.jsx)(R,{action:e,onOpenConversation:a});case"show_slots":{let a=e.slots??[];return(0,t.jsx)("div",{className:u.default.calendarGrid,children:a.map(e=>(0,t.jsx)("button",{className:u.default.slotButton,type:"button",onClick:()=>s?.(e.id),children:e.label},e.id))})}case"confirm_booking":return(0,t.jsxs)("div",{className:u.default.confirmationCard,children:[(0,t.jsx)("strong",{children:"Booking confirmed"}),(0,t.jsx)("p",{children:e.summary})]});case"system_notice":return(0,t.jsx)("div",{className:u.default.noticeBanner,children:e.notice||e.label});case"create_session":if("conversation"in e&&"session"in e)return(0,t.jsxs)("div",{className:u.default.confirmationCard,children:[(0,t.jsx)("strong",{children:"Session Ready"}),(0,t.jsx)("p",{children:e.label??"Sam prepped a new session for you."}),(0,t.jsx)("button",{className:u.default.primaryButton,type:"button",onClick:()=>n?.(e.conversation,e.session),children:"Join Session"})]});if("host"in e&&"guest"in e)return(0,t.jsxs)("div",{className:u.default.confirmationCard,children:[(0,t.jsx)("strong",{children:"Session proposed"}),(0,t.jsxs)("p",{children:[e.host," â†” ",e.guest]}),(0,t.jsxs)("p",{children:["Start: ",e.suggested_start]}),(0,t.jsxs)("p",{children:["Duration: ",e.duration_minutes," min"]}),(0,t.jsx)("p",{children:e.notes})]});return null;case"open_conversation":return(0,t.jsx)("button",{className:u.default.primaryButton,type:"button",onClick:()=>a?.(e.conversationId),children:"Jump into chat"});case"offer_call":return(0,t.jsxs)("div",{className:u.default.noticeBanner,children:[(0,t.jsxs)("strong",{children:[e.participant," is ready for a call."]}),(0,t.jsx)("p",{children:e.availability_window}),(0,t.jsx)("p",{children:e.purpose})]});case"follow_up_prompt":return(0,t.jsxs)("div",{className:u.default.noticeBanner,children:[(0,t.jsx)("strong",{children:"Try asking Sam:"}),(0,t.jsx)("p",{children:e.prompt})]});default:return e.label?(0,t.jsx)("div",{className:u.default.noticeBanner,children:e.label}):null}}var q=e.i(74080);function P(e,t,a){let n,s=a.initialDeps??[];function i(){var i,o,r,l;let d,c;a.key&&(null==(i=a.debug)?void 0:i.call(a))&&(d=Date.now());let u=e();if(!(u.length!==s.length||u.some((e,t)=>s[t]!==e)))return n;if(s=u,a.key&&(null==(o=a.debug)?void 0:o.call(a))&&(c=Date.now()),n=t(...u),a.key&&(null==(r=a.debug)?void 0:r.call(a))){let e=Math.round((Date.now()-d)*100)/100,t=Math.round((Date.now()-c)*100)/100,n=t/16,s=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%câ± ${s(t,5)} /${s(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*n,120))}deg 100% 31%);`,null==a?void 0:a.key)}return null==(l=null==a?void 0:a.onChange)||l.call(a,n),n}return i.updateDeps=e=>{s=e},i}function E(e,t){if(void 0!==e)return e;throw Error(`Unexpected undefined${t?`: ${t}`:""}`)}let A=e=>{let{offsetWidth:t,offsetHeight:a}=e;return{width:t,height:a}},F=e=>e,O=e=>{let t=Math.max(e.startIndex-e.overscan,0),a=Math.min(e.endIndex+e.overscan,e.count-1),n=[];for(let e=t;e<=a;e++)n.push(e);return n},V=(e,t)=>{let a=e.scrollElement;if(!a)return;let n=e.targetWindow;if(!n)return;let s=e=>{let{width:a,height:n}=e;t({width:Math.round(a),height:Math.round(n)})};if(s(A(a)),!n.ResizeObserver)return()=>{};let i=new n.ResizeObserver(t=>{let n=()=>{let e=t[0];if(null==e?void 0:e.borderBoxSize){let t=e.borderBoxSize[0];if(t)return void s({width:t.inlineSize,height:t.blockSize})}s(A(a))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()});return i.observe(a,{box:"border-box"}),()=>{i.unobserve(a)}},D={passive:!0},$="undefined"==typeof window||"onscrollend"in window,H=(e,t)=>{var a,n;let s,i=e.scrollElement;if(!i)return;let o=e.targetWindow;if(!o)return;let r=0,l=e.options.useScrollendEvent&&$?()=>void 0:(a=()=>{t(r,!1)},n=e.options.isScrollingResetDelay,function(...e){o.clearTimeout(s),s=o.setTimeout(()=>a.apply(this,e),n)}),d=a=>()=>{let{horizontal:n,isRtl:s}=e.options;r=n?i.scrollLeft*(s&&-1||1):i.scrollTop,l(),t(r,a)},c=d(!0),u=d(!1);u(),i.addEventListener("scroll",c,D);let m=e.options.useScrollendEvent&&$;return m&&i.addEventListener("scrollend",u,D),()=>{i.removeEventListener("scroll",c),m&&i.removeEventListener("scrollend",u)}},L=(e,t,a)=>{if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[a.options.horizontal?"inlineSize":"blockSize"])}return e[a.options.horizontal?"offsetWidth":"offsetHeight"]},U=(e,{adjustments:t=0,behavior:a},n)=>{var s,i;null==(i=null==(s=n.scrollElement)?void 0:s.scrollTo)||i.call(s,{[n.options.horizontal?"left":"top"]:e+t,behavior:a})};class z{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var a;null==(a=t())||a.disconnect(),e=null},observe:e=>{var a;return null==(a=t())?void 0:a.observe(e,{box:"border-box"})},unobserve:e=>{var a;return null==(a=t())?void 0:a.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,a])=>{void 0===a&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:F,rangeExtractor:O,onChange:()=>{},measureElement:L,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,a;null==(a=(t=this.options).onChange)||a.call(t,this,e)},this.maybeNotify=P(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;let t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{let a=new Map,n=new Map;for(let s=t-1;s>=0;s--){let t=e[s];if(a.has(t.lane))continue;let i=n.get(t.lane);if(null==i||t.end>i.end?n.set(t.lane,t):t.end<i.end&&a.set(t.lane,!0),a.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=P(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,t,a,n,s)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:a,getItemKey:n,enabled:s}),{key:!1}),this.getMeasurements=P(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:a,getItemKey:n,enabled:s},i)=>{if(!s)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));let o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];let r=this.measurementsCache.slice(0,o);for(let s=o;s<e;s++){let e=n(s),o=1===this.options.lanes?r[s-1]:this.getFurthestMeasurement(r,s),l=o?o.end+this.options.gap:t+a,d=i.get(e),c="number"==typeof d?d:this.options.estimateSize(s),u=l+c,m=o?o.lane:s%this.options.lanes;r[s]={index:s,start:l,size:c,end:u,key:e,lane:m}}return this.measurementsCache=r,r},{key:!1,debug:()=>this.options.debug}),this.calculateRange=P(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,a,n)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:a,lanes:n}){let s=e.length-1;if(e.length<=n)return{startIndex:0,endIndex:s};let i=G(0,s,t=>e[t].start,a),o=i;if(1===n)for(;o<s&&e[o].end<a+t;)o++;else if(n>1){let r=Array(n).fill(0);for(;o<s&&r.some(e=>e<a+t);){let t=e[o];r[t.lane]=t.end,o++}let l=Array(n).fill(a+t);for(;i>=0&&l.some(e=>e>=a);){let t=e[i];l[t.lane]=t.start,i--}i=Math.max(0,i-i%n),o=Math.min(s,o+(n-1-o%n))}return{startIndex:i,endIndex:o}}({measurements:e,outerSize:t,scrollOffset:a,lanes:n}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=P(()=>{let e=null,t=null,a=this.calculateRange();return a&&(e=a.startIndex,t=a.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,a,n,s)=>null===n||null===s?[]:e({startIndex:n,endIndex:s,overscan:t,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{let t=this.options.indexAttribute,a=e.getAttribute(t);return a?parseInt(a,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{let a=this.indexFromElement(e),n=this.measurementsCache[a];if(!n)return;let s=n.key,i=this.elementsCache.get(s);i!==e&&(i&&this.observer.unobserve(i),this.observer.observe(e),this.elementsCache.set(s,e)),e.isConnected&&this.resizeItem(a,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{let a=this.measurementsCache[e];if(!a)return;let n=t-(this.itemSizeCache.get(a.key)??a.size);0!==n&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(a,n,this):a.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=n,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(a.index),this.itemSizeCache=new Map(this.itemSizeCache.set(a.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=P(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{let a=[];for(let n=0,s=e.length;n<s;n++){let s=t[e[n]];a.push(s)}return a},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{let t=this.getMeasurements();if(0!==t.length)return E(t[G(0,t.length-1,e=>E(t[e]).start,e)])},this.getOffsetForAlignment=(e,t,a=0)=>{let n=this.getSize(),s=this.getScrollOffset();return"auto"===t&&(t=e>=s+n?"end":"start"),"center"===t?e+=(a-n)/2:"end"===t&&(e-=n),Math.max(Math.min(this.getTotalSize()+this.options.scrollMargin-n,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));let a=this.measurementsCache[e];if(!a)return;let n=this.getSize(),s=this.getScrollOffset();if("auto"===t)if(a.end>=s+n-this.options.scrollPaddingEnd)t="end";else{if(!(a.start<=s+this.options.scrollPaddingStart))return[s,t];t="start"}let i="end"===t?a.end+this.options.scrollPaddingEnd:a.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,t,a.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:a}={})=>{"smooth"===a&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:a})},this.scrollToIndex=(e,{align:t="auto",behavior:a}={})=>{"smooth"===a&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let n=0,s=t=>{if(!this.targetWindow)return;let n=this.getOffsetForIndex(e,t);if(!n)return void console.warn("Failed to get offset for index:",e);let[s,o]=n;this._scrollToOffset(s,{adjustments:void 0,behavior:a}),this.targetWindow.requestAnimationFrame(()=>{let t=this.getScrollOffset(),a=this.getOffsetForIndex(e,o);a?1.01>Math.abs(a[0]-t)||i(o):console.warn("Failed to get offset for index:",e)})},i=t=>{this.targetWindow&&(++n<10?this.targetWindow.requestAnimationFrame(()=>s(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};s(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;let t,a=this.getMeasurements();if(0===a.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=a[a.length-1])?void 0:e.end)??0;else{let e=Array(this.options.lanes).fill(null),n=a.length-1;for(;n>=0&&e.some(e=>null===e);){let t=a[n];null===e[t.lane]&&(e[t.lane]=t.end),n--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:a})=>{this.options.scrollToFn(e,{behavior:a,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}let G=(e,t,a,n)=>{for(;e<=t;){let s=(e+t)/2|0,i=a(s);if(i<n)e=s+1;else{if(!(i>n))return s;t=s-1}}return e>0?e-1:0},Q="undefined"!=typeof document?a.useLayoutEffect:a.useEffect;function W({messages:e,className:n,registerScrollContainer:s,children:i}){let o=(0,a.useRef)(null),r=(0,a.useCallback)(e=>{o.current=e,s?.(e)},[s]),l=function(e){let t=a.useReducer(()=>({}),{})[1],n={...e,onChange:(a,n)=>{var s;n?(0,q.flushSync)(t):t(),null==(s=e.onChange)||s.call(e,a,n)}},[s]=a.useState(()=>new z(n));return s.setOptions(n),Q(()=>s._didMount(),[]),Q(()=>s._willUpdate()),s}({observeElementRect:V,observeElementOffset:H,scrollToFn:U,...{count:e.length,getScrollElement:()=>o.current,estimateSize:()=>120,overscan:8}});return(0,a.useEffect)(()=>{o.current&&0!==e.length&&l.scrollToIndex(e.length-1,{align:"end"})},[e.length,l]),(0,t.jsx)("div",{ref:r,className:n,children:(0,t.jsx)("div",{style:{height:l.getTotalSize(),position:"relative",width:"100%"},children:l.getVirtualItems().map(a=>(0,t.jsx)("div",{ref:l.measureElement,"data-index":a.index,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${a.start}px)`},children:i(e[a.index],a.index)},a.key))})})}var J=e.i(35833);let Z=e=>"sam_response"===e.type||"sam"===e.senderId,K=async(e,t)=>{if(!t||e===t)return;if(!await h.db.conversations.get(t)){let a=await h.db.conversations.get(e)??l.SAM_FALLBACK_CONVERSATION;await h.db.conversations.put({...a,conversationId:t,lastActivity:Date.now()})}let a=await h.db.messages.where("conversationId").equals(e).toArray();await Promise.all(a.map(e=>e.id?h.db.messages.update(e.id,{conversationId:t}):Promise.resolve())),e===l.SAM_CONCIERGE_ID&&await h.db.conversations.delete(l.SAM_CONCIERGE_ID)};function Y({conversation:e,messages:n,registerScrollContainer:s,onOpenConversation:i,onConnectNow:o,onBookTime:r,connectingProfileId:l}){let[d,c]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[p,_]=(0,a.useState)(null),[v,x]=(0,a.useState)(e.conversationId),b=(0,a.useRef)(null),w=(0,a.useRef)(null),S=(0,a.useRef)(null),C=(0,a.useRef)(!0),j=(0,a.useRef)(null),N=(0,a.useCallback)(()=>{requestAnimationFrame(()=>S.current?.focus({preventScroll:!0}))},[]);(0,a.useEffect)(()=>{x(e.conversationId)},[e.conversationId]);let I=(0,a.useMemo)(()=>[...n].sort((e,t)=>e.timestamp-t.timestamp),[n]),k=(0,a.useMemo)(()=>{let e=new Map;return I.forEach(t=>{(t.actions??[]).forEach(t=>{"show_profiles"!==(t.type||t.actionType)||(t.profiles??[]).forEach((t,a)=>{let n="rate_per_minute"in t||"status"in t?{name:t.name??`Profile ${a+1}`,headline:t.headline??"HumanChat expert",expertise:Array.isArray(t.expertise)?t.expertise:[],rate_per_minute:t.rate_per_minute??0,status:t.status??"available"}:{name:t.name??`Profile ${a+1}`,headline:t.headline??"HumanChat expert",expertise:t.scheduledRates?.map(e=>`${e.durationMinutes} min`)??[],rate_per_minute:t.instantRatePerMinute??0,status:t.hasActiveSession?"booked":t.isOnline?"available":"away"},s=n.name?.toLowerCase()??`profile-${a}`;e.set(s,n)})})}),Array.from(e.values())},[I]),M=(0,a.useCallback)(e=>{if(b.current=e,s(e),j.current?.(),e){let t=()=>{C.current=e.scrollHeight-e.scrollTop-e.clientHeight<48};e.addEventListener("scroll",t),t(),j.current=()=>e.removeEventListener("scroll",t)}else j.current=null,C.current=!0},[s]);(0,a.useEffect)(()=>{if(!b.current||!C.current)return;let e=b.current,t=()=>e.scrollTo({top:e.scrollHeight,behavior:"smooth"}),a=requestAnimationFrame(t),n=window.setTimeout(t,220);return()=>{cancelAnimationFrame(a),clearTimeout(n)}},[I.length]),(0,a.useEffect)(()=>{N()},[N]);let B=(0,a.useMemo)(()=>e.participants.find(e=>"sam"!==e)??"user_local",[e.participants]),R=async(e,t,a)=>{let n=a??v;n&&(await (0,h.addMessage)(n,{senderId:"sam",content:e,type:"sam_response",actions:t,timestamp:Date.now()}),await (0,J.notifyNewMessage)("Sam Concierge",e))},q=async(e,t)=>{await h.db.conversations.put({...e,lastActivity:Date.now()}),await h.db.sessions.put(t),i?.(e.conversationId)},P=e=>{e&&i?.(e)},E=async e=>{await (0,h.addMessage)(v,{senderId:B,content:`Let's book slot ${e}.`,type:"user_text",timestamp:Date.now()});try{await R("Got it â€” submitting that slot now.")}catch(e){console.error(e)}},A=e=>{c(t=>{if(t.includes(e.content))return t;let a=`"${e.content}"`;return t?`${t}
${a}`:a})},F=async t=>{if(t.preventDefault(),m)return void N();let a=d.trim();if(!a)return;c(""),N(),_(null),f(!0);let n=v,s=I.map(e=>({role:Z(e)?"sam":"user",content:e.content,timestamp:new Date(e.timestamp).toISOString()})),o=Intl.DateTimeFormat().resolvedOptions().timeZone,r=k.length>0?k:e.participants.filter(e=>"sam"!==e).map(e=>({name:e,headline:"HumanChat expert",status:"available",expertise:[],rate_per_minute:0}));await (0,h.addMessage)(n,{senderId:B,content:a,type:"user_text",timestamp:Date.now()});try{let t=await g({conversationId:n,message:a,conversationHistory:[...s,{role:"user",content:a,timestamp:new Date().toISOString()}],userContext:{sidebarState:{activeConversationId:e.conversationId,totalParticipants:e.participants.length},timezone:o,availableProfiles:r}});t.conversationId&&t.conversationId!==n&&(await K(n,t.conversationId),n=t.conversationId,x(t.conversationId),i?.(t.conversationId)),await R(t.text??"Sam is thinking...",t.actions,n)}catch(e){_(e instanceof Error?e.message:"Unable to reach Sam right now."),await R("Apologies, I could not send that request. Please try again.",void 0,n)}finally{f(!1)}};return(0,t.jsxs)("div",{className:u.default.samView,children:[(0,t.jsx)(W,{messages:I,className:u.default.messageList,registerScrollContainer:M,children:e=>{let a=Z(e);return(0,t.jsx)(y,{message:e,variant:a?"sam":"user",onQuickReply:A,children:a&&e.actions&&e.actions.length>0&&(0,t.jsx)("div",{className:u.default.actionStack,children:e.actions.map((a,n)=>(0,t.jsx)(T,{action:a,onOpenConversation:P,onCreateSession:q,onSelectSlot:E,onConnectNow:o,onBookTime:r,connectingProfileId:l},a.id??`${e.timestamp}-${n}`))})},e.id??`${e.timestamp}-${e.senderId}`)}}),(0,t.jsxs)("form",{ref:w,className:u.default.inputBar,onSubmit:F,children:[(0,t.jsx)("textarea",{ref:S,placeholder:"Message Sam...",value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w.current?.requestSubmit())}}),(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"6px",alignItems:"flex-end"},children:[m&&(0,t.jsxs)("div",{className:u.default.inputStatus,children:[(0,t.jsx)("span",{className:u.default.typingDot}),(0,t.jsx)("span",{className:u.default.typingDot}),(0,t.jsx)("span",{className:u.default.typingDot}),"Thinking..."]}),p&&(0,t.jsx)("div",{className:u.default.error,children:p}),(0,t.jsx)("button",{type:"submit",disabled:!d.trim()||m,children:"Send"})]})]})]})}let X="wss://ws.humanchat.com".replace(/^http/i,"ws"),ee=v.default.env.NEXT_PUBLIC_TURN_URL,et=v.default.env.NEXT_PUBLIC_TURN_USERNAME,ea=v.default.env.NEXT_PUBLIC_TURN_CREDENTIAL,en=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},...ee&&et&&ea?[{urls:ee,username:et,credential:ea}]:[]];class es{pc=null;ws=null;localStream=null;remoteStream=null;sessionId;userId;isInitiator;state="idle";listeners={state:new Set,localStream:new Set,remoteStream:new Set,error:new Set,metric:new Set};connectionTimeout;signalingBase;signalingPath;audioContext;analyser;meterFrame;constructor(e){this.sessionId=e.sessionId,this.userId=e.userId,this.isInitiator=e.isInitiator,this.signalingBase=(e.signalingBaseUrl??X).replace(/\/$/,""),this.signalingPath=e.signalingPath??"/session"}on(e,t){return this.listeners[e].add(t),()=>this.listeners[e].delete(t)}emit(e,t){this.listeners[e].forEach(e=>{try{e(t)}catch(e){console.warn("VideoCall listener failed",e)}})}setState(e){this.state=e,this.emit("state",e)}getState(){return this.state}getLocalStream(){return this.localStream}getRemoteStream(){return this.remoteStream}buildSignalingUrl(){return`${this.signalingBase}${this.signalingPath}/${this.sessionId}?userId=${encodeURIComponent(this.userId)}`}async requestMedia(){this.setState("permission");try{this.localStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.emit("localStream",this.localStream),this.startAudioMeter(this.localStream)}catch(t){let e="Unable to access media devices.";throw t?.name==="NotAllowedError"||t?.name==="SecurityError"?e="Camera/microphone permissions denied.":t?.name==="NotFoundError"||t?.name==="DevicesNotFoundError"?e="No camera or microphone detected. Try connecting different hardware.":t instanceof Error&&t.message&&(e=t.message),this.emit("error",e),this.setState("failed"),t}}startAudioMeter(e){try{let t=window.AudioContext||window.webkitAudioContext;if(!t)return;this.audioContext=new t;let a=this.audioContext.createMediaStreamSource(e);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,a.connect(this.analyser);let n=new Uint8Array(this.analyser.frequencyBinCount),s=()=>{if(!this.analyser)return;this.analyser.getByteTimeDomainData(n);let e=0;for(let t=0;t<n.length;t+=1){let a=n[t]-128;e+=a*a}let t=Math.sqrt(e/n.length)/128;this.emit("metric",{audioLevel:Number(t.toFixed(2)),connectionState:this.pc?.connectionState,iceState:this.pc?.iceConnectionState}),this.meterFrame=window.requestAnimationFrame(s)};this.meterFrame=window.requestAnimationFrame(s)}catch(e){console.warn("Audio meter unavailable",e)}}stopAudioMeter(){this.meterFrame&&(cancelAnimationFrame(this.meterFrame),this.meterFrame=void 0),this.analyser?.disconnect(),this.audioContext?.close().catch(()=>void 0)}createPeerConnection(){this.pc=new RTCPeerConnection({iceServers:en}),this.localStream&&this.localStream.getTracks().forEach(e=>{this.pc.addTrack(e,this.localStream)}),this.pc.ontrack=e=>{this.remoteStream=e.streams[0],this.emit("remoteStream",this.remoteStream)},this.pc.onicecandidate=e=>{e.candidate&&this.sendSignal({type:"ice-candidate",candidate:e.candidate})},this.pc.onconnectionstatechange=()=>{let e=this.pc?.connectionState;"connected"===e?(this.setState("connected"),this.clearConnectionTimeout()):"failed"===e?(this.emit("error","Peer connection failed. Retryingâ€¦"),this.restartIce(),this.setState("failed")):"disconnected"===e&&this.setState("disconnected"),this.emit("metric",{audioLevel:0,connectionState:e,iceState:this.pc?.iceConnectionState})},this.pc.oniceconnectionstatechange=()=>{this.pc?.iceConnectionState==="failed"&&this.restartIce()}}restartIce(){this.pc&&(this.pc.restartIce(),this.isInitiator&&this.createAndSendOffer(!0).catch(e=>{console.error("ICE restart offer failed",e)}))}connectSignaling(){this.ws=new WebSocket(this.buildSignalingUrl()),this.ws.onopen=()=>{this.setState("connecting"),this.startConnectionTimeout(),this.isInitiator&&this.createAndSendOffer().catch(e=>this.emit("error",e.message))},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleSignal(t)}catch(e){console.warn("Invalid signaling payload",e)}},this.ws.onerror=()=>{this.emit("error","Signaling channel error")},this.ws.onclose=()=>{"ended"!==this.state&&this.setState("disconnected")}}async handleSignal(e){if(this.pc)switch(e.type){case"offer":if(!e.offer)return;await this.pc.setRemoteDescription(new RTCSessionDescription(e.offer));let t=await this.pc.createAnswer();await this.pc.setLocalDescription(t),this.sendSignal({type:"answer",answer:t});break;case"answer":if(!e.answer)return;await this.pc.setRemoteDescription(new RTCSessionDescription(e.answer));break;case"ice-candidate":if(!e.candidate)return;await this.pc.addIceCandidate(e.candidate);break;case"peer-left":this.setState("disconnected")}}async createAndSendOffer(e=!1){if(!this.pc)throw Error("Peer connection not ready");let t=await this.pc.createOffer({iceRestart:e});await this.pc.setLocalDescription(t),this.sendSignal({type:"offer",offer:t})}sendSignal(e){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({...e,senderId:this.userId}))}startConnectionTimeout(){this.clearConnectionTimeout(),this.connectionTimeout=setTimeout(()=>{"connected"!==this.state&&(this.emit("error","Connection timed out. Trying againâ€¦"),this.isInitiator&&this.pc&&this.createAndSendOffer(!0).catch(e=>this.emit("error",e.message)))},3e4)}clearConnectionTimeout(){this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}async start(){("idle"===this.state||"failed"===this.state||"disconnected"===this.state)&&(await this.requestMedia(),this.createPeerConnection(),this.connectSignaling())}toggleMute(){if(!this.localStream)return!1;let e=this.localStream.getAudioTracks()[0];return!!e&&(e.enabled=!e.enabled,e.enabled)}toggleVideo(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];return!!e&&(e.enabled=!e.enabled,e.enabled)}endCall(){this.setState("ended"),this.clearConnectionTimeout(),this.stopAudioMeter(),this.localStream?.getTracks().forEach(e=>e.stop()),this.remoteStream?.getTracks().forEach(e=>e.stop()),this.pc?.close(),this.ws?.close(),this.pc=null,this.ws=null,this.localStream=null,this.remoteStream=null,this.emit("localStream",null),this.emit("remoteStream",null)}}var ei=e.i(62265),eo=e.i(43318);let er=(e,t)=>{switch(e){case"mic":return t?"ðŸŽ™ï¸":"ðŸ”‡";case"cam":return t?"ðŸŽ¥":"ðŸ“·âœ–ï¸";case"end":default:return"ðŸ“žâœ–ï¸";case"share":return"ðŸ“¤";case"pip":return t?"ðŸªŸ":"ðŸ—”"}};function el({isMuted:e,isVideoOff:a,disabled:s,onToggleMute:i,onToggleVideo:o,onEndCall:r,onShareInvite:l,onTogglePiP:d,canShare:c}){return(0,t.jsxs)("div",{className:u.default.controlsRow,children:[(0,t.jsxs)("button",{type:"button",className:(0,n.default)(u.default.controlButton,e&&u.default.controlButtonMuted),onClick:i,disabled:s,children:[er("mic",!e)," ",e?"Unmute":"Mute"]}),(0,t.jsxs)("button",{type:"button",className:(0,n.default)(u.default.controlButton,a&&u.default.controlButtonMuted),onClick:o,disabled:s,children:[er("cam",!a)," ",a?"Camera On":"Camera Off"]}),l&&(0,t.jsxs)("button",{type:"button",className:u.default.controlButton,onClick:l,disabled:s||!c,children:[er("share",!0)," Share"]}),d&&(0,t.jsxs)("button",{type:"button",className:u.default.controlButton,onClick:d,disabled:s,children:[er("pip",!0)," PiP"]}),(0,t.jsxs)("button",{type:"button",className:(0,n.default)(u.default.controlButton,u.default.controlButtonDanger),onClick:r,disabled:s,children:[er("end",!1)," End Call"]})]})}function ed({elapsedSeconds:e}){var a;let n,s,i,o;return(0,t.jsx)("div",{className:u.default.timerBadge,children:(n=Math.floor((a=Math.max(0,e))/60),s=a%60,i=Math.floor(n/60),o=n%60,i>0?`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`)})}let ec=e=>`$${e.toFixed(2)}`,eu=(e,t)=>e.confidentialRate?0:Math.max(0,t/60*(e.instantRatePerMinute??(e.durationMinutes>0?e.agreedPrice/e.durationMinutes:0)));function em({session:e,elapsedSeconds:a}){if(e.confidentialRate)return(0,t.jsxs)("div",{className:u.default.billingBadge,children:[(0,t.jsx)("span",{children:"Session Fee:"}),(0,t.jsx)("strong",{children:"Private Rate"}),(0,t.jsx)("small",{className:u.default.billingSubtext,children:"Their representative will send the final invoice."})]});if("charity"===e.paymentMode){let a="scheduled"===e.type?"Scheduled rate":"Live rate",n="scheduled"===e.type?e.agreedPrice/Math.max(e.durationMinutes,1):e.instantRatePerMinute??0;return(0,t.jsxs)("div",{className:u.default.billingBadge,children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{children:[a,":"]}),(0,t.jsxs)("strong",{children:[ec(n)," â†’ ",e.charityName??"charity partner"]})]}),(0,t.jsx)("small",{className:u.default.billingSubtext,children:"100% goes to charity"})]})}if("free"===e.paymentMode)return(0,t.jsxs)("div",{className:u.default.billingBadge,children:[(0,t.jsx)("span",{children:"Session:"}),(0,t.jsx)("strong",{children:"Free"})]});if("scheduled"===e.type)return(0,t.jsxs)("div",{className:u.default.billingBadge,children:[(0,t.jsx)("span",{children:"Session:"}),(0,t.jsx)("strong",{children:ec(e.agreedPrice)})]});let n=eu(e,a);return(0,t.jsxs)("div",{className:u.default.billingBadge,children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsx)("strong",{children:ec(n)})]})}let eh=e=>e<768?"mobile":e<=1024?"tablet":"desktop",ef=()=>{let[e,t]=(0,a.useState)(()=>eh(window.innerWidth));return(0,a.useEffect)(()=>{let e=()=>t(eh(window.innerWidth));return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),{breakpoint:e,isMobile:"mobile"===e,isTablet:"tablet"===e,isDesktop:"desktop"===e}};function ep({session:e,currentUserId:n,onCallEnd:s}){let i=(0,a.useRef)(null),o=(0,a.useRef)(null),r=(0,a.useRef)(null),[l,d]=(0,a.useState)("idle"),[c,m]=(0,a.useState)(null),[f,p]=(0,a.useState)(!1),[_,v]=(0,a.useState)(!1),[g,y]=(0,a.useState)(()=>Math.max(0,Math.floor((Date.now()-(e.startTime??Date.now()))/1e3))),x=(0,a.useRef)(e.startTime??Date.now()),b=(0,a.useRef)(!1),w=(0,a.useRef)(!1),S=!!e.confidentialRate,{isMobile:C}=ef(),[j,N]=(0,a.useState)(!1),I=(0,a.useMemo)(()=>e.hostUserId===n,[e.hostUserId,n]),k=(0,a.useCallback)(()=>(i.current||(i.current=new es({sessionId:e.sessionId,userId:n,isInitiator:I})),i.current),[e.sessionId,n,I]),M=(0,a.useCallback)((e,t,a=!1)=>{e&&(e.srcObject=t,e.muted=a,t&&e.play().catch(()=>void 0))},[]);(0,a.useEffect)(()=>{let t=k(),a=t.on("state",t=>{d(t),"connected"!==t||b.current||(b.current=!0,x.current=Date.now(),ei.sessionStatusManager.startSession(e.sessionId,n).then(async()=>{await h.db.sessions.put({...e,status:"in_progress",startTime:x.current})}).catch(e=>m(e instanceof Error?e.message:"Unable to update session status")))}),s=t.on("localStream",e=>M(o.current,e,!0)),l=t.on("remoteStream",e=>M(r.current,e,!1)),c=t.on("error",e=>m(e));return t.start().catch(e=>{m(e instanceof Error?e.message:"Unable to start call")}),()=>{a(),s(),l(),c(),t.endCall(),i.current=null}},[k,M,e.sessionId,n,e]),(0,a.useEffect)(()=>{let e=window.setInterval(()=>{"connected"===l&&y(Math.max(0,Math.floor((Date.now()-x.current)/1e3)))},1e3);return()=>window.clearInterval(e)},[l]),(0,a.useEffect)(()=>{let e=r.current;if(!e)return;let t=()=>N(!0),a=()=>N(!1);return e.addEventListener("enterpictureinpicture",t),e.addEventListener("leavepictureinpicture",a),()=>{e.removeEventListener("enterpictureinpicture",t),e.removeEventListener("leavepictureinpicture",a)}},[]),(0,a.useEffect)(()=>{if(!C||"connected"!==l)return;let e=screen.orientation;if(e?.lock)return e.lock("landscape").catch(()=>void 0),()=>{e.unlock?.()}},[l,C]),(0,a.useEffect)(()=>{let e=()=>{"hidden"!==document.visibilityState||"connected"!==l||j||T()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[l,j]);let B="undefined"!=typeof navigator&&!!navigator.share,R=async()=>{let t=e.hostUserId===n?e.guestUserId:e.hostUserId,a=`${window.location.origin}/chat?session=${e.sessionId}`,s={title:"Join my HumanChat session",text:`Join me${t?` and ${t}`:""} on HumanChat right now`,url:a};try{navigator.share?await navigator.share(s):navigator.clipboard&&await navigator.clipboard.writeText(s.url??a)}catch(e){console.warn("Share failed",e)}},T=async()=>{if(document.pictureInPictureEnabled&&r.current)try{j?await document.exitPictureInPicture():await r.current.requestPictureInPicture()}catch(e){console.warn("PiP toggle failed",e)}},q=async()=>{if(w.current)return;w.current=!0,i.current?.endCall(),d("ended");try{await ei.sessionStatusManager.endSession(e.sessionId,n),await h.db.sessions.put({...e,status:"complete",endTime:Date.now(),durationMinutes:Math.max(1,Math.ceil(g/60))})}catch(e){console.warn("Failed to update session end locally",e)}let t=S||"free"===e.paymentMode?0:"scheduled"===e.type?e.agreedPrice:eu(e,g),a=!S&&!!(e.donationAllowed??"on"===e.donationPreference),o=e.paymentMode??"paid",r="charity"===o?"charity":"scheduled"===e.type?"scheduled":"instant";if(!(!S&&("paid"===o||"charity"===o)))return void s({durationSeconds:g,totalAmount:t,currency:"usd",paymentMode:o,donationAllowed:a,charityName:e.charityName,sessionId:e.sessionId,confidentialRate:S,representativeName:e.representativeName??null});try{let n=await (0,eo.processSessionPayment)(t,e.sessionId,{mode:r,captureMethod:"scheduled"===e.type?"automatic":"manual",finalAmount:t}),i={durationSeconds:g,totalAmount:n.amount,currency:n.currency,paymentIntentId:n.paymentIntentId,paymentMode:o,donationAllowed:a,charityName:e.charityName,sessionId:e.sessionId,confidentialRate:S,representativeName:e.representativeName??null};await (0,J.notifyPaymentComplete)(n.amount,n.currency),s(i)}catch(n){m(n instanceof Error?n.message:"Payment failed"),s({durationSeconds:g,totalAmount:t,currency:"usd",paymentMode:o,donationAllowed:a,charityName:e.charityName,sessionId:e.sessionId,confidentialRate:S,representativeName:e.representativeName??null})}};return(0,t.jsxs)("div",{className:u.default.videoAreaWrapper,children:[(0,t.jsxs)("div",{className:u.default.videoStatsRow,children:[(0,t.jsx)(em,{session:e,elapsedSeconds:g}),(0,t.jsx)(ed,{elapsedSeconds:g})]}),(0,t.jsxs)("div",{className:u.default.videoStage,children:[(0,t.jsx)("video",{ref:r,playsInline:!0,autoPlay:!0,className:u.default.remoteVideo}),(0,t.jsx)("video",{ref:o,playsInline:!0,autoPlay:!0,muted:!0,className:u.default.localPreview}),("connected"!==l||c)&&(0,t.jsx)("div",{className:u.default.videoOverlay,children:c??"Connectingâ€¦"}),(0,t.jsx)("div",{className:u.default.controlsOverlay,children:(0,t.jsx)(el,{isMuted:f,isVideoOff:_,onToggleMute:()=>{let e=i.current?.toggleMute();"boolean"==typeof e&&p(!e)},onToggleVideo:()=>{let e=i.current?.toggleVideo();"boolean"==typeof e&&v(!e)},onEndCall:q,onShareInvite:R,onTogglePiP:T,canShare:B,disabled:"connecting"===l||"failed"===l})})]})]})}function e_({conversation:e,messages:n,registerScrollContainer:s,currentUserId:i}){let[o,r]=(0,a.useState)(""),[l,d]=(0,a.useState)(!1),c=(0,a.useRef)(null),m=(0,a.useMemo)(()=>[...n].sort((e,t)=>e.timestamp-t.timestamp),[n]);(0,a.useEffect)(()=>()=>{c.current&&clearTimeout(c.current)},[]);let f=async t=>{t.preventDefault();let a=o.trim();a&&i&&(r(""),d(!1),await (0,h.addMessage)(e.conversationId,{senderId:i,content:a,type:"user_text"}))},p=e=>{r(t=>t?`${t}
${e.content}`:e.content)};return(0,t.jsxs)("div",{className:u.default.chatArea,children:[(0,t.jsx)(W,{messages:m,className:u.default.messageList,registerScrollContainer:s,children:e=>{let a=!!i&&e.senderId===i;return(0,t.jsx)(y,{message:e,variant:a?"user":"sam",onQuickReply:p})}}),l&&(0,t.jsx)("div",{className:u.default.typingIndicator,children:"Typingâ€¦"}),(0,t.jsxs)("form",{className:u.default.chatInputBar,onSubmit:f,children:[(0,t.jsx)("textarea",{placeholder:"Message during sessionâ€¦",value:o,onChange:e=>{r(e.target.value),d(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>d(!1),1200)},disabled:!i}),(0,t.jsx)("button",{type:"submit",disabled:!o.trim()||!i,children:"Send"})]})]})}function ev({summary:e,onDismiss:a,onDonate:n}){var s;let i,o=e.representativeName??e.peerName??"their representative";return(0,t.jsx)("div",{className:u.default.endCallOverlay,role:"dialog","aria-modal":"true",children:(0,t.jsxs)("div",{className:u.default.endCallCard,children:[(0,t.jsx)("h3",{children:"Session complete"}),(0,t.jsxs)("p",{children:["You talked for ",(i=Math.floor((s=e.durationSeconds)/60),`${i}m ${(s%60).toString().padStart(2,"0")}s`),"."]}),e.confidentialRate?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Session fee: ",(0,t.jsx)("strong",{children:"Private Rate"})]}),(0,t.jsxs)("p",{children:[o," will follow up with the finalized amount."]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Billing total: ",(0,t.jsxs)("strong",{children:[e.currency.toUpperCase()," $",e.totalAmount.toFixed(2)]})]}),e.paymentIntentId?(0,t.jsxs)("p",{children:["Stripe payment confirmed (intent ",e.paymentIntentId,")."]}):(0,t.jsx)("p",{children:"No payment required."})]}),"charity"===e.paymentMode&&e.charityName&&(0,t.jsxs)("p",{children:["Your contribution supports ",e.charityName,"!"]}),e.donationAllowed&&"charity"!==e.paymentMode&&!e.confidentialRate&&(0,t.jsx)("p",{children:"Want to send a little extra thanks?"}),(0,t.jsxs)("div",{className:u.default.endCallActions,children:[e.donationAllowed&&n&&!e.confidentialRate&&(0,t.jsxs)("button",{type:"button",className:u.default.secondaryButton,onClick:n,children:["Send thanks",e.peerName?` to ${e.peerName}`:""]}),(0,t.jsx)("button",{type:"button",className:u.default.primaryButton,onClick:a,children:"Close"})]})]})})}let eg=[5,10,20],ey=e=>`$${e.toFixed(2)}`;function ex({sessionId:e,hostName:n,charityName:s,paymentMode:i,onClose:o}){let[r,l]=(0,a.useState)(eg[1]),[d,c]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[f,p]=(0,a.useState)(null),[_,v]=(0,a.useState)(null),g=(0,a.useMemo)(()=>{let e=Number(d);return!Number.isNaN(e)&&e>0?e:r},[d,r]),y=(0,a.useMemo)(()=>"charity"===i&&s?`Your tip will be routed directly to ${s}.`:`Tips are paid out to ${n} (minus platform fees).`,[i,s,n]),x=async t=>{t.preventDefault(),v(null),p(null);let a=Number(g);if(!Number.isFinite(a)||a<=0)return void v("Enter a valid amount.");h(!0);try{let t=Math.round(100*a),n=await (0,eo.initiateDonation)(e,t);n.checkoutUrl?(window.open(n.checkoutUrl,"_blank","noopener"),p("Redirected to Stripe Checkout to finish your tip.")):p("Thanks! Your tip was processed."),c("")}catch(e){v(e instanceof Error?e.message:"Unable to process donation right now.")}finally{h(!1)}};return(0,t.jsx)("div",{className:u.default.donationModal,role:"dialog","aria-modal":"true",children:(0,t.jsxs)("form",{className:u.default.donationCard,onSubmit:x,children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{children:["Send thanks to ",n]}),(0,t.jsx)("p",{children:y})]}),(0,t.jsx)("div",{className:u.default.donationGrid,children:eg.map(e=>{let a=!d&&r===e;return(0,t.jsx)("button",{type:"button",className:`${u.default.donationAmountButton} ${a?u.default.donationAmountButtonActive:""}`.trim(),onClick:()=>{l(e),c("")},children:ey(e)},e)})}),(0,t.jsxs)("div",{className:u.default.donationInputRow,children:[(0,t.jsx)("label",{htmlFor:"custom-amount",children:"Custom"}),(0,t.jsx)("input",{id:"custom-amount",type:"number",min:"1",step:"1",placeholder:"Enter amount",value:d,onChange:e=>c(e.target.value)})]}),_&&(0,t.jsx)("span",{className:u.default.error,children:_}),f&&(0,t.jsx)("span",{className:u.default.statusBadge,children:f}),(0,t.jsxs)("div",{className:u.default.donationFooter,children:[(0,t.jsx)("button",{type:"submit",className:u.default.primaryButton,disabled:m,children:m?"Sendingâ€¦":`Tip ${ey(g)}`}),(0,t.jsx)("button",{type:"button",className:u.default.secondaryButton,onClick:o,disabled:m,children:"Skip"})]})]})})}function eb({conversation:e,session:n,messages:s,registerScrollContainer:i}){let[o,r]=(0,a.useState)(Date.now()),[l,d]=(0,a.useState)(()=>ei.sessionStatusManager.getCurrentUserId()),[c,m]=(0,a.useState)(null),[h,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=window.setInterval(()=>r(Date.now()),1e3);return()=>window.clearInterval(e)},[]),(0,a.useEffect)(()=>{let e=ei.sessionStatusManager.onCurrentUserChange(e=>d(e));return()=>e()},[]);let p=(0,a.useMemo)(()=>[...s].sort((e,t)=>e.timestamp-t.timestamp),[s]),_=n?.status==="in_progress",v=n?.status==="complete",g=!_&&!v&&(n?.startTime??0)>o,x=(0,a.useMemo)(()=>e.participants.find(e=>e!==l)??"Session participant",[e.participants,l]);if(g){let e,a,s,i,o;return(0,t.jsxs)("div",{className:u.default.countdown,children:[(0,t.jsx)("strong",{children:(a=Math.floor((e=Math.max(0,n.startTime-Date.now()))/1e3)%60,s=Math.floor(e/6e4)%60,i=Math.floor(e/36e5),o=e=>e.toString().padStart(2,"0"),`${o(i)}:${o(s)}:${o(a)}`)}),(0,t.jsx)("p",{children:"Session starts in"})]})}if(v||!n)return(0,t.jsxs)("div",{className:u.default.archivedView,children:[(0,t.jsx)("div",{className:u.default.archivedNotice,children:"This session has ended. Messages are read-only."}),(0,t.jsx)(W,{messages:p,className:u.default.messageList,registerScrollContainer:i,children:a=>(0,t.jsx)(y,{message:a,variant:e.participants.includes(a.senderId)?"user":"sam"})})]});if(!n||!l)return(0,t.jsx)("div",{className:u.default.error,children:"Sign in again to join this session."});let b=!!(c?.donationAllowed&&!c.confidentialRate&&h&&n);return(0,t.jsxs)("div",{className:u.default.sessionShell,children:[(0,t.jsx)("div",{className:u.default.videoSection,children:(0,t.jsx)(ep,{session:n,currentUserId:l,onCallEnd:e=>{m({...e,peerName:x}),f(!1)}})}),(0,t.jsx)("div",{className:u.default.chatSection,children:(0,t.jsx)(e_,{conversation:e,messages:s,registerScrollContainer:i,currentUserId:l})}),c&&(0,t.jsx)(ev,{summary:c,onDismiss:()=>{m(null),f(!1)},onDonate:c.donationAllowed?()=>f(!0):void 0}),b&&c&&(0,t.jsx)(ex,{sessionId:c.sessionId,hostName:c.peerName??"your host",charityName:c.charityName,paymentMode:c.paymentMode,onClose:()=>f(!1)})]})}let ew=e=>new Intl.DateTimeFormat("en-US",{timeZone:e,hour:"numeric",minute:"2-digit"}),eS=(e,t)=>new Intl.DateTimeFormat("en-US",{timeZone:t,weekday:"short",month:"short",day:"numeric"}).format(new Date(e)),eC=(e,t,a)=>{let n=ew(a).format(new Date(e)),s=ew(a).format(new Date(t));return`${n} - ${s}`},ej=(e,t)=>{let a=new Intl.DateTimeFormat("en-US",{timeZone:e,timeZoneName:"short"}).formatToParts(t?new Date(t):new Date).find(e=>"timeZoneName"===e.type);return a?.value??e},eN=(e,t)=>{let a=new Date(e).getTime();return Math.max(0,Math.round((new Date(t).getTime()-a)/6e4))},eI="https://api.humanchat.com",ek=[{id:"fallback-1",start:"2025-11-07T18:00:00Z",end:"2025-11-07T18:30:00Z",status:"open"},{id:"fallback-2",start:"2025-11-07T19:00:00Z",end:"2025-11-07T19:45:00Z",status:"open"}],eM=async()=>{try{let e=await fetch(`${eI}/api/calendar/availability`,{method:"GET",credentials:"include"});if(!e.ok){let t=await e.text().catch(()=>"");throw Error(t||"Failed to fetch calendar availability")}let t=await e.json(),a=Array.isArray(t?.slots)?t.slots.map((e,t)=>{let a="blocked"===e.status?"blocked":"open";return{id:e.id??`slot-${t}`,start:e.start,end:e.end,status:a}}).filter(e=>e.start&&e.end):[];return a.length>0?a:ek}catch(e){return console.warn("Falling back to sample slots",e),ek}},eB=async e=>{let t=await fetch(`${eI}/api/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({host_user_id:e.hostUserId,guest_user_id:e.guestUserId,conversation_id:e.conversationId,type:"scheduled",start_time:e.startTime,duration_minutes:e.durationMinutes,agreed_price:e.price,payment_mode:e.price>0?"paid":"free"})});if(!t.ok)throw Error(await t.text().catch(()=>"")||"Unable to create session");return(await t.json()).session};var eR=e.i(77841);let eT=[15,30,60],eq=e=>eT.find(t=>t<=e)??e;function eP({slots:e,timezone:n,getPriceForDuration:s,onSelect:i,loading:o,error:r}){let[l,d]=(0,a.useState)({}),c=(0,a.useMemo)(()=>e.filter(e=>"open"===e.status),[e]);return o?(0,t.jsx)("div",{className:eR.default.loadingState,children:"Loading available timesâ€¦"}):r?(0,t.jsx)("div",{className:eR.default.errorState,children:r}):c.length?(0,t.jsx)("div",{className:eR.default.slotGrid,children:c.map(e=>{let a=eN(e.start,e.end),o=eT.filter(e=>e<=a),r=l[e.id]??eq(a),c=ej(n,e.start);return(0,t.jsxs)("div",{className:eR.default.slotCard,children:[(0,t.jsx)("div",{className:eR.default.slotDate,children:eS(e.start,n)}),(0,t.jsxs)("div",{className:eR.default.slotTime,children:[eC(e.start,e.end,n)," â€¢ ",c]}),(0,t.jsxs)("div",{className:eR.default.durationRow,children:[o.map(a=>(0,t.jsxs)("button",{type:"button",className:`${eR.default.durationButton} ${r===a?eR.default.durationButtonActive:""}`,onClick:()=>{var t;return t=e.id,void d(e=>({...e,[t]:a}))},children:[a," min â€¢ $",s(a).toFixed(0)]},`${e.id}-${a}`)),0===o.length&&(0,t.jsx)("div",{className:eR.default.slotTime,children:"Slot too short for our presets."})]}),(0,t.jsxs)("div",{className:eR.default.priceRow,children:["Selected Â· ",r," min Â· $",s(r).toFixed(2)]}),(0,t.jsx)("button",{type:"button",className:eR.default.selectButton,onClick:()=>{let t,a,n;return t=eN(e.start,e.end),n=s(a=l[e.id]??eq(t)),void i(e,a,n)},children:"Select"})]},e.id)})}):(0,t.jsx)("div",{className:eR.default.emptyState,children:"No open slots detected. Try syncing your calendar or pick another profile."})}function eE({profile:e,slot:a,durationMinutes:n,price:s,timezone:i,isSubmitting:o,error:r,onConfirm:l,onBack:d}){return(0,t.jsxs)("div",{className:eR.default.confirmationCard,children:[(0,t.jsxs)("div",{className:eR.default.summaryRow,children:[(0,t.jsx)("span",{className:eR.default.summaryLabel,children:"Meeting with"}),(0,t.jsx)("span",{className:eR.default.summaryValue,children:e.name})]}),(0,t.jsxs)("div",{className:eR.default.summaryRow,children:[(0,t.jsx)("span",{className:eR.default.summaryLabel,children:"When"}),(0,t.jsxs)("span",{className:eR.default.summaryValue,children:[eS(a.start,i)," â€¢ ",eC(a.start,a.end,i)]})]}),(0,t.jsxs)("div",{className:eR.default.summaryRow,children:[(0,t.jsx)("span",{className:eR.default.summaryLabel,children:"Timezone"}),(0,t.jsx)("span",{className:eR.default.summaryValue,children:ej(i,a.start)})]}),(0,t.jsxs)("div",{className:eR.default.summaryRow,children:[(0,t.jsx)("span",{className:eR.default.summaryLabel,children:"Duration"}),(0,t.jsxs)("span",{className:eR.default.summaryValue,children:[n," min"]})]}),(0,t.jsxs)("div",{className:eR.default.summaryRow,children:[(0,t.jsx)("span",{className:eR.default.summaryLabel,children:"Total"}),(0,t.jsxs)("span",{className:eR.default.summaryValue,children:["$",s.toFixed(2)]})]}),r&&(0,t.jsx)("div",{className:eR.default.errorState,children:r}),(0,t.jsxs)("div",{className:eR.default.buttonRow,children:[(0,t.jsx)("button",{type:"button",className:eR.default.secondaryButton,onClick:d,disabled:o,children:"Go Back"}),(0,t.jsx)("button",{type:"button",className:eR.default.primaryButton,onClick:l,disabled:o,children:o?"Bookingâ€¦":"Confirm Booking"})]})]})}let eA={15:45,30:85,60:150};function eF({open:e,profile:n,conversation:s,onClose:i}){let o=(0,a.useMemo)(()=>(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone??"UTC"}catch(e){return console.warn("Unable to resolve timezone, defaulting to UTC",e),"UTC"}})(),[]),[r,l]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[h,f]=(0,a.useState)(null),[p,_]=(0,a.useState)("select"),[v,y]=(0,a.useState)(!1),[x,b]=(0,a.useState)(null),w=(0,a.useCallback)(()=>{f(null),b(null),l([]),m(null),_("select")},[]);(0,a.useEffect)(()=>{if(!e)return void w();let t=!1;return c(!0),m(null),eM().then(e=>{t||l(e)}).catch(e=>{console.warn("Booking slot fetch failed",e),t||m(e instanceof Error?e.message:"Unable to load slots")}).finally(()=>{t||c(!1)}),()=>{t=!0}},[e,n?.userId,w]),(0,a.useEffect)(()=>{if("success"!==p)return;let e=setTimeout(()=>{i()},2400);return()=>clearTimeout(e)},[p,i]);let S=(0,a.useCallback)(e=>{let t=n?.scheduledRates?.find(t=>t.durationMinutes===e);return t?t.price:n?.instantRatePerMinute?n.instantRatePerMinute*e:eA[e]??3*e},[n]),C=async()=>{if(!h||!n||!s)return void b("Missing booking details. Please try again.");let e=ei.sessionStatusManager.getCurrentUserId();if(!e)return void b("We need your account info before booking. Please sign in again.");y(!0),b(null);try{await eB({hostUserId:n.userId,guestUserId:e,conversationId:s.conversationId,startTime:h.slot.start,durationMinutes:h.duration,price:h.price}),await g({conversationId:s.conversationId,message:`Book ${h.duration}-minute session with ${n.name} on ${h.slot.start}.`,conversationHistory:[],userContext:{timezone:o,booking:{start:h.slot.start,end:h.slot.end,duration_minutes:h.duration,price:h.price,expert:n.name}}}).catch(e=>{console.warn("Sam booking notification failed",e)}),await (0,J.scheduleCallReminder)(new Date(h.slot.start).getTime(),n.name??"your host"),_("success")}catch(e){b(e instanceof Error?e.message:"Unable to confirm booking")}finally{y(!1)}};return e&&n?(0,t.jsx)("div",{className:eR.default.overlay,role:"dialog","aria-modal":"true",children:(0,t.jsx)("div",{className:eR.default.modal,children:(0,t.jsxs)("div",{className:eR.default.modalInner,children:[(0,t.jsxs)("div",{className:eR.default.header,children:[(0,t.jsx)("img",{src:n?.avatarUrl?n.avatarUrl:n?.name?`https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(n.name)}`:"https://api.dicebear.com/8.x/initials/svg?seed=Human",alt:n.name,className:eR.default.avatar}),(0,t.jsxs)("div",{className:eR.default.titleStack,children:[(0,t.jsx)("div",{className:eR.default.title,children:n.name}),(0,t.jsx)("div",{className:eR.default.subtitle,children:"Book a session"})]}),(0,t.jsx)("button",{type:"button",className:eR.default.closeButton,onClick:()=>{w(),i()},children:"Ã—"})]}),"select"===p&&(0,t.jsx)(eP,{slots:r,timezone:o,getPriceForDuration:S,onSelect:(e,t,a)=>{f({slot:e,duration:t,price:a}),_("confirm"),b(null)},loading:d,error:u}),"confirm"===p&&h&&(0,t.jsx)(eE,{profile:n,slot:h.slot,durationMinutes:h.duration,price:h.price,timezone:o,isSubmitting:v,error:x,onBack:()=>{_("select"),b(null)},onConfirm:C}),"success"===p&&(0,t.jsxs)("div",{className:eR.default.successState,children:[(0,t.jsx)("div",{className:eR.default.successMessage,children:"Booked! You'll get a reminder 5 min before."}),(0,t.jsx)("p",{children:"Sam logged the session and will keep both sides updated."})]})]})})}):null}let eO=async e=>{let t,a=await fetch("https://api.humanchat.com/api/requests",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_user_id:e.targetUserId,message:e.message,preferred_time:e.preferredTime||void 0,budget_range:e.budgetRange||void 0})});if(!a.ok)throw Error(await a.text().catch(()=>"")||"Unable to send request.");let n=await a.json();if(!n?.request)throw Error("Malformed request response.");return{api:n.request,local:{requestId:(t=n.request).id,requesterId:t.requester_user_id,targetUserId:t.target_user_id,managerId:t.manager_user_id??null,representativeName:t.representative_name??null,message:t.message,preferredTime:t.preferred_time??null,budgetRange:t.budget_range??null,status:t.status,createdAt:Date.parse(t.created_at)}}};var eV=e.i(46246);function eD({open:e,profile:n,conversation:s,onClose:i}){let[o,r]=(0,a.useState)(""),[l,d]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[p,_]=(0,a.useState)(null),[v,g]=(0,a.useState)("form"),[y,x]=(0,a.useState)("their representative"),b=!n?.confidentialRate;(0,a.useEffect)(()=>{if(!e){r(""),d(""),u(""),_(null),f(!1),g("form");return}x(n?.managerName??"their representative")},[e,n]);let w=(0,a.useCallback)(()=>{r(""),d(""),u(""),_(null),f(!1),g("form"),i()},[i]),S=(0,a.useCallback)(async e=>{s&&await (0,h.addMessage)(s.conversationId,{senderId:"sam",content:`Request sent to ${e}. They'll respond within 24 hours.`,type:"sam_response",timestamp:Date.now()})},[s]),C=async e=>{if(e.preventDefault(),!n)return void _("Profile missing. Please retry.");if(!o.trim())return void _("Tell the rep why you want to connect.");f(!0),_(null);try{let{local:e}=await eO({targetUserId:n.userId,message:o.trim(),preferredTime:l.trim()||void 0,budgetRange:c.trim()||void 0});await (0,h.saveManagedRequest)(e);let t=e.representativeName??n.managerName??"their representative";x(t),await S(t).catch(e=>{console.warn("Failed to log Sam receipt",e)}),g("success")}catch(e){_(e instanceof Error?e.message:"Unable to send request right now.")}finally{f(!1)}};return e&&n?(0,t.jsx)("div",{className:eV.default.overlay,role:"dialog","aria-modal":"true",children:(0,t.jsxs)("div",{className:eV.default.modal,children:[(0,t.jsxs)("div",{className:eV.default.header,children:[(0,t.jsxs)("div",{className:eV.default.headerLeft,children:[(0,t.jsx)("img",{src:n?.avatarUrl?n.avatarUrl:n?.name?`https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(n.name)}`:"https://api.dicebear.com/8.x/initials/svg?seed=Guest",alt:n.name??"Managed profile",className:eV.default.avatar}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:eV.default.title,children:n.name}),(0,t.jsx)("div",{className:eV.default.subtitle,children:"Managed request"})]})]}),(0,t.jsx)("button",{type:"button",className:eV.default.closeButton,onClick:w,children:"Ã—"})]}),"form"===v&&(0,t.jsxs)("form",{className:eV.default.form,onSubmit:C,children:[(0,t.jsxs)("label",{className:eV.default.label,children:["Why do you want to connect?",(0,t.jsx)("textarea",{value:o,onChange:e=>r(e.target.value),placeholder:"Share the context for this chat",required:!0})]}),(0,t.jsxs)("label",{className:eV.default.label,children:["Preferred date/time ",(0,t.jsx)("span",{className:eV.default.optional,children:"(optional)"}),(0,t.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Next Tue after 3 PM PT"})]}),b&&(0,t.jsxs)("label",{className:eV.default.label,children:["Budget range ",(0,t.jsx)("span",{className:eV.default.optional,children:"(optional)"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),placeholder:"$5k - $7k"})]}),p&&(0,t.jsx)("div",{className:eV.default.error,children:p}),(0,t.jsx)("button",{type:"submit",className:eV.default.submitButton,disabled:m||!o.trim(),children:m?"Sendingâ€¦":"Send Request"})]}),"success"===v&&(0,t.jsxs)("div",{className:eV.default.successState,children:[(0,t.jsx)("div",{className:eV.default.successIcon,children:"âœ“"}),(0,t.jsxs)("p",{children:["Request sent to ",(0,t.jsx)("strong",{children:y}),". They'll respond within 24 hours."]}),(0,t.jsx)("button",{type:"button",className:eV.default.primaryButton,onClick:w,children:"Close"})]})]})}):null}let e$=async e=>{let t="Unable to start a live session right now.";if(!e.ok)throw Error(await e.text().catch(()=>"")||t);let a=await e.json().catch(()=>({}));if(!a?.data?.conversation||!a?.data?.session)throw Error(t);return a.data},eH=e=>{if(!e)return Date.now();let t=Date.parse(e);return Number.isFinite(t)?t:Date.now()},eL=async(e,t)=>{let a;if(!e.userId)throw Error("Missing target profile id.");let n=await fetch("https://api.humanchat.com/api/conversations/connect",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_user_id:e.userId})}),{conversation:s,session:i}=await e$(n),o=Array.from(new Set([t,e.userId])),r=(a=i.id,{conversationId:s.id,type:s.type,participants:o,linkedSessionId:a,lastActivity:eH(s.last_activity),unreadCount:0}),l={sessionId:i.id,conversationId:i.conversation_id,hostUserId:i.host_user_id,guestUserId:i.guest_user_id,type:i.type,status:i.status,startTime:eH(i.start_time),endTime:i.end_time?eH(i.end_time):void 0,durationMinutes:i.duration_minutes,agreedPrice:i.agreed_price,instantRatePerMinute:e.instantRatePerMinute??void 0,paymentMode:i.payment_mode,donationAllowed:i.donation_allowed??"on"===e.donationPreference,donationPreference:e.donationPreference??i.donation_preference??void 0,donationTarget:i.donation_target??void 0,charityName:e.charityName??i.charity_name??void 0,charityId:e.charityId??i.charity_id??void 0,charityStripeAccountId:i.charity_stripe_account_id??void 0,confidentialRate:e.confidentialRate??i.confidential_rate??void 0,representativeName:i.representative_name??null,displayMode:i.display_mode??e.displayMode??void 0};return await h.db.conversations.put(r),await h.db.sessions.put(l),await h.db.messages.add({conversationId:r.conversationId,senderId:"sam",content:`${e.name??"Your host"} is getting ready to join you now.`,timestamp:Date.now(),type:"system_notice"}),r.conversationId};function eU({activeConversationId:e,onSelectConversation:s,isMobile:i,onBack:o}){let{conversation:r,session:l,messages:d,loading:c,error:h}=(e=>{let[t,n]=(0,a.useState)(f),s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(s.current?.unsubscribe(),!e)return void n(f);n(e=>({...e,loading:!0,error:null}));let t=(0,m.liveQuery)(()=>_(e)).subscribe({next:e=>{if(!e)return void n({conversation:null,session:null,messages:[],loading:!1,error:null});let t=e.session??null;n({...e,session:t,loading:!1,error:null})},error:e=>{n({conversation:null,session:null,messages:[],loading:!1,error:e instanceof Error?e:Error(String(e))})}});return s.current=t,()=>t.unsubscribe()},[e]),(0,a.useMemo)(()=>t,[t])})(e),p=(0,a.useRef)(new Map),v=(0,a.useRef)({node:null}),[g,y]=(0,a.useState)(null),[x,b]=(0,a.useState)(null),[w,S]=(0,a.useState)(null),[C,j]=(0,a.useState)(null),N=(0,a.useCallback)(t=>{if(v.current.cleanup?.(),v.current={node:t},!t||!e)return;let a=p.current.get(e);"number"==typeof a?t.scrollTop=a:t.scrollTop=t.scrollHeight;let n=()=>{p.current.set(e,t.scrollTop)};t.addEventListener("scroll",n),v.current.cleanup=()=>{t.removeEventListener("scroll",n),p.current.set(e,t.scrollTop)}},[e]);(0,a.useEffect)(()=>()=>{v.current.cleanup?.()},[]);let I=(0,a.useMemo)(()=>e?r?{title:"sam"===r.type?"Sam Concierge":r.participants.join(", "),subtitle:"sam"===r.type?"AI Concierge":"Direct chat"}:{title:"Conversation not found",subtitle:"It may have been removed locally. Try syncing again."}:{title:"No conversation selected",subtitle:"Pick a conversation from the sidebar to get started."},[e,r]),k=(0,a.useCallback)(async e=>{if(!e.userId)return void S("Unable to start a session for this profile.");let t=ei.sessionStatusManager.getCurrentUserId();if(!t)return void S("Please sign back in to start a live session.");j(e.userId),S(null);try{let a=await eL(e,t);s?.(a)}catch(e){S(e instanceof Error?e.message:"Sam could not connect that session.")}finally{j(t=>t===e.userId?null:t)}},[s]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{className:(0,n.default)(u.default.container,i&&u.default.mobileContainer),children:[(0,t.jsxs)("div",{className:u.default.header,children:[(0,t.jsxs)("div",{className:u.default.headerTitleStack,children:[i&&(0,t.jsx)("button",{type:"button",className:u.default.backButton,onClick:o,children:"â† Back"}),(0,t.jsx)("div",{className:u.default.title,children:I.title}),(0,t.jsx)("div",{className:u.default.subtitle,children:I.subtitle})]}),r&&(0,t.jsxs)("div",{className:u.default.subtitle,children:["Last activity â€¢ ",new Date(r.lastActivity).toLocaleTimeString()]})]}),w&&(0,t.jsx)("div",{className:u.default.error,children:w}),(0,t.jsxs)("div",{className:u.default.viewArea,children:[!e&&(0,t.jsx)("div",{className:u.default.placeholder,children:"Choose a conversation to see the full history and context."}),e&&c&&(0,t.jsx)("div",{className:u.default.loading,children:"Loading conversationâ€¦"}),e&&h&&!c&&(0,t.jsx)("div",{className:u.default.error,children:"Failed to load conversation. Please retry."}),e&&r&&!c&&!h&&(0,t.jsx)("div",{className:(0,n.default)(u.default.viewArea),children:"sam"===r.type?(0,t.jsx)(Y,{conversation:r,messages:d,registerScrollContainer:N,onOpenConversation:s,onConnectNow:k,connectingProfileId:C,onBookTime:e=>{e.managed&&e.confidentialRate?b(e):y(e)}}):(0,t.jsx)(eb,{conversation:r,session:l,messages:d,registerScrollContainer:N})},r.conversationId)]})]}),(0,t.jsx)(eF,{open:!!g,profile:g,conversation:r??null,onClose:()=>y(null)}),(0,t.jsx)(eD,{open:!!x,profile:x,conversation:r??null,onClose:()=>b(null)})]})}let ez=[{key:"home",label:"Home"},{key:"discover",label:"Discover"},{key:"sam",label:"Sam"},{key:"profile",label:"Profile"}];function eG({active:e,onChange:a,hasUnread:s}){return(0,t.jsx)("nav",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-white/10 bg-black/80 backdrop-blur-xl","aria-label":"Primary navigation",children:(0,t.jsx)("div",{className:"grid grid-cols-4",children:ez.map(i=>(0,t.jsxs)("button",{type:"button",className:(0,n.default)("flex flex-col items-center justify-center gap-1 py-3 text-xs font-semibold tracking-wide transition",e===i.key?"text-white":"text-white/60"),"aria-label":i.label,onClick:()=>a(i.key),children:[(0,t.jsx)("span",{className:"flex h-8 w-8 items-center justify-center rounded-full border border-white/20 text-xs uppercase",children:i.label.charAt(0)}),(0,t.jsx)("span",{children:i.label}),s&&"home"===i.key&&(0,t.jsx)("span",{className:"mt-1 rounded-full bg-peach px-2 py-0.5 text-[10px] uppercase tracking-widest text-midnight",children:"New"})]},i.key))})})}let eQ=[{userId:"discover-priya",name:"Priya Desai",headline:"Climate Policy Translator",bio:"Turns dense policy into action steps for local teams.",conversationType:"paid",instantRatePerMinute:15,scheduledRates:[{durationMinutes:30,price:450},{durationMinutes:60,price:850}],isOnline:!0,hasActiveSession:!1},{userId:"discover-jamal",name:"Jamal Ortiz",headline:"Product Coach for AI Teams",bio:"Guides founding teams through zero-to-one launches.",conversationType:"paid",instantRatePerMinute:18,isOnline:!1,hasActiveSession:!0}];function eW({onBookProfile:e}){let[n,s]=(0,a.useState)(""),i=(0,a.useMemo)(()=>n.trim()?eQ.filter(e=>e.name?.toLowerCase().includes(n.toLowerCase())):eQ,[n]);return(0,t.jsxs)("section",{className:"flex min-h-[calc(100vh-64px)] flex-col gap-6 bg-gradient-to-b from-black/60 to-transparent px-4 pb-24 pt-6 text-white",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Discover"}),(0,t.jsx)("p",{className:"text-sm text-white/70",children:"Search across trending experts."})]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 rounded-2xl border border-white/15 bg-white/5 px-4 py-3 text-sm text-white/80 focus-within:border-white/40",children:[(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":!0,children:[(0,t.jsx)("circle",{cx:"11",cy:"11",r:"7",stroke:"currentColor",strokeWidth:"2",fill:"none"}),(0,t.jsx)("line",{x1:"16",y1:"16",x2:"22",y2:"22",stroke:"currentColor",strokeWidth:"2"})]}),(0,t.jsx)("input",{type:"search",value:n,onChange:e=>s(e.target.value),placeholder:"Find a person or topic",className:"w-full bg-transparent text-base text-white outline-none placeholder:text-white/40","aria-label":"Search profiles"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:i.map(a=>(0,t.jsx)(I,{profile:a,onBookTime:e},a.userId))})]})}var eJ=e.i(69237),eZ=e.i(23612);function eK(){let[e,n]=(0,a.useState)(),[s,i]=(0,a.useState)(!1),[o,r]=(0,a.useState)("list"),[d,u]=(0,a.useState)("home"),[m,h]=(0,a.useState)(!0),{isMobile:f,isTablet:p}=ef(),{conversations:_,unreadTotal:v}=(0,l.useConversationData)(),g=(0,a.useMemo)(()=>_.find(e=>"sam"===e.conversation.type)?.conversation.conversationId??"sam-concierge",[_]);(0,a.useEffect)(()=>{"sam"===new URLSearchParams(window.location.search).get("focus")&&i(!0)},[]),(0,a.useEffect)(()=>{s&&(n(g),f?(u("sam"),r("conversation")):u("home"))},[s,g,f]);let y=e=>{n(e),f&&(r("conversation"),u("home"))};return(0,t.jsxs)("main",{className:"flex h-screen min-h-screen flex-col overflow-hidden bg-midnight text-white",children:[(0,t.jsxs)("header",{className:"sticky top-0 z-20 flex flex-wrap items-center gap-3 border-b border-white/10 bg-midnight px-4 py-3 text-xs uppercase tracking-[0.3em] text-white/60",children:[(0,t.jsx)("span",{children:"Workspace"}),p&&(0,t.jsx)("button",{type:"button",className:"rounded-full border border-white/20 px-3 py-1 text-[11px] normal-case tracking-normal text-white",onClick:()=>h(e=>!e),children:m?"Expand sidebar":"Collapse sidebar"}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(eZ.default,{})})]}),(0,t.jsxs)("div",{className:"flex flex-1 min-h-0 overflow-hidden",children:[!f&&(0,t.jsx)("div",{className:"flex h-full shrink-0 overflow-hidden",children:(0,t.jsx)(c,{activeConversationId:e,onSelectConversation:y,collapsed:p&&m})}),f?(0,t.jsxs)("section",{className:"relative flex min-h-0 flex-1 flex-col overflow-hidden",children:["discover"===d&&(0,t.jsx)(eW,{onBookProfile:()=>u("home")}),"profile"===d&&(0,t.jsx)(eJ.default,{}),"home"===d&&"list"===o&&(0,t.jsx)(c,{activeConversationId:e,onSelectConversation:y}),("sam"===d||"home"===d&&"conversation"===o)&&(0,t.jsx)(eU,{activeConversationId:e??g,onSelectConversation:y,isMobile:!0,onBack:()=>{r("list")}})]}):(0,t.jsx)("section",{className:"flex flex-1 flex-col overflow-hidden",children:(0,t.jsx)(eU,{activeConversationId:e,onSelectConversation:y})})]}),f&&(0,t.jsx)(eG,{active:d,onChange:t=>{u(t),"home"===t&&r(e?"conversation":"list"),"sam"===t&&(n(g),r("conversation"))},hasUnread:v>0})]})}e.s(["default",()=>eK],19596)}]);