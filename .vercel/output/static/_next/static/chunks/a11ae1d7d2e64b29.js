(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,n)=>{t.exports=e.r(76562)},7670,e=>{"use strict";e.s(["default",0,function(){for(var e,t,n=0,a="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=function e(t){var n,a,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var r=t.length;for(n=0;n<r;n++)t[n]&&(a=e(t[n]))&&(i&&(i+=" "),i+=a)}else for(a in t)t[a]&&(i&&(i+=" "),i+=a);return i}(e))&&(a&&(a+=" "),a+=t);return a}])},90001,e=>{"use strict";var t=e.i(43476),n=e.i(7670),a=e.i(18566),i=e.i(71645);e.i(51718);var r=e.i(18357),s=e.i(97822),l=e.i(16437),o=e.i(62265),c=e.i(51445);e.s(["default",0,({className:e,children:d})=>{let u=(0,a.useRouter)(),[h,m]=(0,i.useState)(!1),x=async()=>{if(!h){m(!0);try{try{await (0,l.logout)()}catch(e){console.error("Failed to clear server session",e)}try{await (0,r.signOut)(s.firebaseAuth)}catch(e){console.error("Failed to clear Firebase session",e)}}finally{o.sessionStatusManager.setCurrentUserId(null),window.dispatchEvent(new CustomEvent(c.AUTH_UPDATED_EVENT)),m(!1),u.replace("/")}}};return(0,t.jsx)("button",{type:"button",onClick:x,disabled:h,className:(0,n.default)("rounded-full border border-white/20 px-4 py-1 text-sm text-white transition hover:border-white/40 disabled:cursor-not-allowed disabled:opacity-60",e),children:d??(h?"Signing out…":"Logout")})}])},66096,e=>{"use strict";var t=e.i(71645);e.i(47167);let n="https://api.humanchat.com",a=async e=>{if(!e.ok)throw Error(await e.text().catch(()=>"")||"Request failed");return e.json()},i=(e={})=>({credentials:"include",headers:{"Content-Type":"application/json",...e.headers??{}},...e}),r=e=>{let t=e??{},n=t.data??t,a=n.settings??n;return{settings:{isOnline:!!(a.is_online??a.isOnline),conversationType:a.conversation_type??a.conversationType??"free",instantRatePerMinute:(e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim().length>0){let t=Number(e);return Number.isFinite(t)?t:null}return null})(a.instant_rate_per_minute??a.instantRatePerMinute??null),charityId:a.charity_id??a.charityId??null,donationPreference:!!(a.donation_preference??a.donationPreference),calendarConnected:!!(a.calendar_connected??a.calendarConnected),stripeConnected:!!(a.stripe_connected??a.stripeConnected),onboardingComplete:!!(a.onboarding_complete??a.onboardingComplete)},charities:n.charities??[]}},s=async()=>r(await a(await fetch(`${n}/api/settings`,i()))),l=async e=>r(await a(await fetch(`${n}/api/settings/availability`,{...i({method:"PATCH"}),body:JSON.stringify({is_online:e})}))).settings,o=async e=>{let t={conversation_type:e.conversationType,donation_preference:e.donationPreference},s="number"==typeof e.instantRatePerMinute&&Number.isFinite(e.instantRatePerMinute)?e.instantRatePerMinute:void 0;return"paid"===e.conversationType&&void 0!==s&&(t.instant_rate_per_minute=s),void 0!==e.charityId&&(t.charity_id=e.charityId),r(await a(await fetch(`${n}/api/settings/connection`,{...i({method:"PATCH"}),body:JSON.stringify(t)}))).settings},c=async()=>{let e=await a(await fetch(`${n}/api/calendar/connect`,i({method:"POST"}))),t=e.data??e;return{redirectUrl:t.url??t.redirectUrl??null}},d=async()=>r(await a(await fetch(`${n}/api/calendar/disconnect`,i({method:"POST"})))).settings,u=async()=>{let e=await a(await fetch(`${n}/api/stripe/connect`,i({method:"POST"}))),t=e.data??e;return{redirectUrl:t.url??t.redirectUrl??null}},h=async()=>r(await a(await fetch(`${n}/api/stripe/disconnect`,i({method:"POST"})))).settings,m=async()=>r(await a(await fetch(`${n}/api/settings`,{...i({method:"PATCH"}),body:JSON.stringify({onboarding_complete:!0})}))).settings,x="humanchat.availability.expireAt",p="humanchat.availability.prompt";e.s(["AVAILABILITY_PROMPT_KEY",0,p,"AVAILABILITY_STORAGE_KEY",0,x,"useSettings",0,()=>{let[e,n]=(0,t.useState)(null),[a,i]=(0,t.useState)([]),[r,b]=(0,t.useState)(!0),[f,w]=(0,t.useState)(null),[y,g]=(0,t.useState)(!1),[v,N]=(0,t.useState)(!1),[j,C]=(0,t.useState)(!1),[S,k]=(0,t.useState)(!1),[T,A]=(0,t.useState)(!1),I=(0,t.useCallback)(e=>{if(n(e),e?.isOnline){let e=Date.now()+18e5;window.localStorage.setItem(x,String(e)),window.localStorage.removeItem(p)}else window.localStorage.removeItem(x)},[]),E=(0,t.useCallback)(async()=>{b(!0);try{let{settings:e,charities:t}=await s();I(e),i(t),w(null)}catch(e){w(e instanceof Error?e.message:"Unable to load settings.")}finally{b(!1)}},[I]);(0,t.useEffect)(()=>{E()},[E]);let P=(0,t.useCallback)(async()=>{g(!0);try{let{settings:e,charities:t}=await s();I(e),i(t),w(null)}catch(e){w(e instanceof Error?e.message:"Unable to refresh settings.")}finally{g(!1)}},[I]),_=(0,t.useCallback)(async e=>{N(!0);try{let t=await l(e);I(t),w(null)}catch(e){w(e instanceof Error?e.message:"Unable to update availability.")}finally{N(!1)}},[I]),O=(0,t.useCallback)(async e=>{C(!0);try{let t=await o(e);I(t),w(null)}catch(e){throw w(e instanceof Error?e.message:"Unable to update connection settings."),e}finally{C(!1)}},[I]),R=(0,t.useCallback)(async()=>{k(!0);try{let{redirectUrl:e}=await c();if(e){window.location.href=e;return}await P()}catch(e){w(e instanceof Error?e.message:"Unable to connect calendar.")}finally{k(!1)}},[P]),U=(0,t.useCallback)(async()=>{k(!0);try{let e=await d();I(e),w(null)}catch(e){w(e instanceof Error?e.message:"Unable to disconnect calendar.")}finally{k(!1)}},[I]);return{settings:e,charities:a,loading:r,error:f,refreshing:y,savingAvailability:v,savingConnection:j,savingCalendar:S,savingStripe:T,updateAvailability:_,saveConnection:O,startCalendarConnect:R,disconnectCalendar:U,startStripeConnect:(0,t.useCallback)(async()=>{A(!0);try{let{redirectUrl:e}=await u();if(e){window.location.href=e;return}await P()}catch(e){w(e instanceof Error?e.message:"Unable to connect Stripe.")}finally{A(!1)}},[P]),disconnectStripe:(0,t.useCallback)(async()=>{A(!0);try{let e=await h();I(e),w(null)}catch(e){w(e instanceof Error?e.message:"Unable to disconnect Stripe.")}finally{A(!1)}},[I]),refresh:P,markOnboardingDone:(0,t.useCallback)(async()=>{try{let e=await m();I(e)}catch(e){throw w(e instanceof Error?e.message:"Unable to complete onboarding."),e}},[I])}}],66096)},93505,e=>{"use strict";var t=e.i(43476),n=e.i(18566),a=e.i(71645),i=e.i(90001),r=e.i(66096);let s=[{id:"climate-action",name:"Climate Action Network"},{id:"youth-mentorship",name:"Youth Mentorship Initiative"},{id:"open-access",name:"Open Access Education Fund"}];function l(){let e=(0,n.useRouter)(),{settings:l,charities:o,loading:c,error:d,updateAvailability:u,saveConnection:h,savingAvailability:m,savingConnection:x,savingCalendar:p,savingStripe:b,startCalendarConnect:f,disconnectCalendar:w,startStripeConnect:y,disconnectStripe:g,refresh:v}=(0,r.useSettings)(),[N,j]=(0,a.useState)("free"),[C,S]=(0,a.useState)(""),[k,T]=(0,a.useState)(null),[A,I]=(0,a.useState)(!0),[E,P]=(0,a.useState)(null),[_,O]=(0,a.useState)(null),[R,U]=(0,a.useState)(!1),[M,Y]=(0,a.useState)(null);(0,a.useEffect)(()=>{l&&(j(l.conversationType??"free"),S(l.instantRatePerMinute?String(l.instantRatePerMinute):""),T(l.charityId),I(l.donationPreference??!0),P(null))},[l]),(0,a.useEffect)(()=>{l?.isOnline||O(null)},[l?.isOnline]),(0,a.useEffect)(()=>{let e=()=>{if(!l?.isOnline)return;let e=window.localStorage.getItem(r.AVAILABILITY_STORAGE_KEY),t=e?Number(e):null;t&&Date.now()>t&&(u(!1),window.localStorage.setItem(r.AVAILABILITY_PROMPT_KEY,"true"),O("We turned off your availability after 30 minutes of inactivity."))},t=window.setInterval(e,6e4);return e(),()=>window.clearInterval(t)},[l?.isOnline,u]),(0,a.useEffect)(()=>{let e=()=>{l?.isOnline||"true"!==window.localStorage.getItem(r.AVAILABILITY_PROMPT_KEY)?U(!1):U(!0)};return window.addEventListener("focus",e),e(),()=>window.removeEventListener("focus",e)},[l?.isOnline]);let L=o.length>0?o:s,$=C.trim(),D=$?Number($):null,q=(0,a.useMemo)(()=>{if(!l)return!1;let e=l.instantRatePerMinute?String(l.instantRatePerMinute):"";return l.conversationType!==N||e!==$||(l.charityId??"")!==(k??"")||l.donationPreference!==A},[l,N,$,k,A]),F=[];"paid"===N&&(null===D||!Number.isFinite(D)||D<=0)&&F.push("Rate must be greater than $0 to accept paid requests."),"charity"!==N||k||F.push("Select a charity partner before continuing."),"paid"!==N&&"charity"!==N||l?.stripeConnected||F.push("Connect Stripe first to accept paid or charity conversations.");let K=async()=>{if(l){if(P(null),F.length>0)return void P(F[0]);try{await h({conversationType:N,instantRatePerMinute:"paid"===N?Number($):null,charityId:"charity"===N?k:null,donationPreference:A}),P("Settings updated")}catch(e){P(e instanceof Error?e.message:"Unable to save changes.")}}},B=async()=>{!l?.calendarConnected||window.confirm("Disconnect calendar? Scheduled bookings will be disabled.")&&(Y(null),await w(),Y("Calendar disconnected. Scheduled bookings are disabled."))},G=async()=>{!l||("free"!==l.conversationType?Y("Switch to free mode before disconnecting Stripe."):window.confirm("Disconnect Stripe? You will need to offer free conversations.")&&(Y(null),await g(),Y("Stripe disconnected. You are now listed as Free.")))};return c?(0,t.jsx)("main",{className:"flex min-h-screen items-center justify-center bg-midnight text-white",children:(0,t.jsx)("p",{className:"text-sm text-white/70",children:"Loading settings…"})}):d?(0,t.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center gap-4 bg-midnight text-white",children:[(0,t.jsx)("p",{className:"text-sm text-white/70",children:d}),(0,t.jsx)("button",{type:"button",className:"rounded-full border border-white/20 px-5 py-2 text-sm",onClick:()=>v(),children:"Try again"})]}):(0,t.jsxs)("main",{className:"min-h-screen bg-midnight text-white",children:[(0,t.jsx)("header",{className:"border-b border-white/10 px-6 py-6",children:(0,t.jsx)("div",{className:"mx-auto flex max-w-5xl flex-wrap items-center gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.35em] text-white/50",children:"Settings"}),(0,t.jsx)("h1",{className:"text-3xl font-semibold",children:"Control how members reach you"})]})})}),(0,t.jsxs)("section",{className:"mx-auto flex max-w-5xl flex-col gap-8 px-4 py-10",children:[(0,t.jsxs)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,t.jsxs)("header",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Availability"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Toggle whether Sam can surface you in discovery."})]}),(0,t.jsx)("button",{type:"button",disabled:m,onClick:()=>{l&&u(!l.isOnline)},className:`rounded-full border px-5 py-2 text-xs font-semibold uppercase tracking-[0.3em] ${l?.isOnline?"border-aqua/60 text-aqua":"border-white/20 text-white/60"}`,children:m?"Saving…":l?.isOnline?"on":"off"})]}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:l?.isOnline?"You appear in search and Sam can route instant connects.":"You are hidden until you toggle availability back on."}),_&&(0,t.jsx)("p",{className:"mt-3 text-xs text-amber-300",children:_}),R&&(0,t.jsxs)("div",{className:"mt-4 rounded-2xl border border-white/15 bg-black/40 p-4 text-sm text-white/80",children:[(0,t.jsx)("p",{children:"You were set to offline after inactivity. Turn availability back on?"}),(0,t.jsx)("button",{type:"button",className:"mt-3 rounded-full bg-gradient-to-r from-indigoGlow to-aqua px-5 py-2 text-xs font-semibold text-midnight",onClick:()=>{U(!1),window.localStorage.removeItem(r.AVAILABILITY_PROMPT_KEY),u(!0)},children:"Re-enable availability"})]})]}),(0,t.jsxs)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Connection settings"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Choose how you connect and whether you accept tips."}),(0,t.jsx)("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:["free","paid","charity"].map(e=>(0,t.jsxs)("button",{type:"button",className:`rounded-2xl border p-4 text-left text-sm ${N===e?"border-aqua/60 bg-aqua/10 text-white":"border-white/10 text-white/70 hover:border-white/30"}`,onClick:()=>j(e),children:[(0,t.jsx)("p",{className:"text-base font-semibold capitalize text-white",children:e}),(0,t.jsxs)("p",{className:"mt-2 text-xs text-white/60",children:["free"===e&&"Members can join instantly with no payment.","paid"===e&&"Set a live rate for instant connects.","charity"===e&&"Donate the proceeds to a partner organization."]})]},e))}),"paid"===N&&(0,t.jsxs)("label",{className:"mt-6 block text-sm text-white/80",children:["Rate per minute (USD)",(0,t.jsx)("input",{type:"number",min:"0",step:"0.5",value:C,onChange:e=>S(e.target.value),className:"mt-2 w-full rounded-2xl border border-white/15 bg-black/50 px-4 py-3 text-white focus:border-aqua/60",placeholder:"3.00"})]}),"charity"===N&&(0,t.jsxs)("label",{className:"mt-6 block text-sm text-white/80",children:["Charity partner",(0,t.jsxs)("select",{value:k??"",onChange:e=>T(e.target.value||null),className:"mt-2 w-full rounded-2xl border border-white/15 bg-black/50 px-4 py-3 text-white focus:border-aqua/60",children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Choose a charity"}),L.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)("div",{className:"mt-6 flex items-center gap-3",children:(0,t.jsxs)("label",{className:"flex cursor-pointer items-center gap-3 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded",checked:A,onChange:e=>I(e.target.checked)}),"Accept optional tips (",A?"enabled":"disabled",")"]})}),F.length>0&&(0,t.jsx)("ul",{className:"mt-4 list-disc space-y-1 pl-5 text-xs text-rose-300",children:F.map(e=>(0,t.jsx)("li",{children:e},e))}),E&&(0,t.jsx)("p",{className:"mt-4 text-xs text-white/70",children:E}),(0,t.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-4",children:[(0,t.jsx)("button",{type:"button",disabled:!q||x,onClick:()=>void K(),className:"rounded-full bg-gradient-to-r from-indigoGlow to-aqua px-6 py-3 text-sm font-semibold text-midnight disabled:opacity-40",children:x?"Saving…":"Save changes"}),(0,t.jsxs)("p",{className:"text-xs text-white/60",children:["Current mode: ",(0,t.jsx)("span",{className:"font-semibold text-white",children:N})," ","paid"===N&&D?`\xb7 ${(e=>{if(!e)return"$0.00";let t=Number(e);return Number.isFinite(t)?`$${t.toFixed(2*(t%1!=0))}`:"$0.00"})($)}/min`:null]})]})]}),(0,t.jsxs)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Calendar & payments"}),(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Keep Sam aligned with your availability and payouts."}),(0,t.jsxs)("div",{className:"mt-6 grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-4",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:"Google Calendar"}),(0,t.jsx)("p",{className:"text-xs text-white/60",children:l?.calendarConnected?"Connected ✓":"Not connected"}),(0,t.jsx)("div",{className:"mt-4 flex flex-wrap gap-3",children:l?.calendarConnected?(0,t.jsx)("button",{type:"button",disabled:p,onClick:()=>void B(),className:"rounded-full border border-white/20 px-5 py-2 text-xs",children:p?"Disconnecting…":"Disconnect"}):(0,t.jsx)("button",{type:"button",disabled:p,onClick:()=>void f(),className:"rounded-full bg-gradient-to-r from-indigoGlow to-aqua px-5 py-2 text-xs font-semibold text-midnight",children:p?"Connecting…":"Connect Google Calendar"})})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-4",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:"Stripe"}),(0,t.jsx)("p",{className:"text-xs text-white/60",children:l?.stripeConnected?"Connected ✓":"Not connected"}),(0,t.jsx)("div",{className:"mt-4 flex flex-wrap gap-3",children:l?.stripeConnected?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:"rounded-full border border-white/20 px-5 py-2 text-xs",onClick:()=>e.push("/settings/payments"),children:"Manage account"}),(0,t.jsx)("button",{type:"button",disabled:b,onClick:()=>void G(),className:"rounded-full border border-white/20 px-5 py-2 text-xs",children:b?"Disconnecting…":"Disconnect"})]}):(0,t.jsx)("button",{type:"button",disabled:b,onClick:()=>void y(),className:"rounded-full bg-gradient-to-r from-indigoGlow to-aqua px-5 py-2 text-xs font-semibold text-midnight",children:b?"Connecting…":"Connect Stripe"})})]})]}),M&&(0,t.jsx)("p",{className:"mt-4 text-xs text-white/70",children:M})]}),(0,t.jsxs)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Account"}),(0,t.jsxs)("div",{className:"mt-4 flex flex-col gap-3 text-sm",children:[(0,t.jsx)("button",{type:"button",className:"rounded-2xl border border-white/15 px-4 py-3 text-left hover:border-white/40",onClick:()=>e.push("/auth/change-password"),children:"Change password"}),(0,t.jsx)(i.default,{className:"rounded-2xl border border-white/15 px-4 py-3 text-left text-white/80 hover:border-white/40"}),(0,t.jsx)("button",{type:"button",className:"rounded-2xl border border-rose-400/40 px-4 py-3 text-left text-rose-200 hover:border-rose-300",onClick:()=>{window.confirm("Delete your account? This action cannot be undone.")&&e.push("/support/delete-account")},children:"Delete account"})]})]})]})]})}e.s(["default",()=>l])}]);